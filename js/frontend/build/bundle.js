(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _diffDom = require("diff-dom");

class DetectChanges {
  constructor() {
    this.observer = null;
    this.exclude = [];
    this.dd = new _diffDom.DiffDOM();
  }

  async init() {
    this.setupMutationObserver();
  }

  setupMutationObserver() {
    this.observer = new MutationObserver(mutations => {
      mutations.forEach(mutations__value => {
        this.onDomChange(mutations__value);
      });
    }).observe(document.body, {
      childList: true,
      attributes: false,
      characterData: true,
      subtree: true
    });
  }

  async onDomChange(mutation) {
    let nodes = [];

    if (mutation.addedNodes.length > 0) {
      nodes = mutation.addedNodes;
    } else if (mutation.removedNodes.length === 0 && mutation.target !== null) {
      nodes = [mutation.target];
    }

    if (nodes.length === 0) {
      return;
    }

    for (let nodes__value of nodes) {
      if (this.isExcluded(nodes__value)) {
        continue;
      }

      if (nodes__value.nodeType != 1 && nodes__value.nodeType != 3) {
        continue;
      }

      if (nodes__value.nodeType == 3) {
        nodes__value = nodes__value.parentNode;
      }

      if (nodes__value.tagName === 'BODY') {
        continue;
      }

      let html = ''; // this is important: previously set attributes must be removed (because they could have changed in the meantime again)

      nodes__value.removeAttribute('data-gtbabel-hide');
      html = nodes__value.outerHTML;
      nodes__value.setAttribute('data-gtbabel-hide', '');
      let resp = await this.getTranslation(html);
      console.log(resp);
      let trans = resp.success === true ? resp.data : html;
      this.setHtmlAndKeepEventListeners(nodes__value, trans);
    }
  }

  setHtmlAndKeepEventListeners(node, html) {
    this.exclude.push(node);
    let diff = this.dd.diff(node, html);
    this.dd.apply(node, diff);
    requestAnimationFrame(() => {
      this.exclude = this.exclude.filter(exclude__value => exclude__value !== node);
    });
  }

  getTranslation(html) {
    return new Promise(resolve => {
      let data = new URLSearchParams();
      data.append('html', html);
      let url = window.location.protocol + '//' + window.location.host + window.location.pathname;
      url += (url.indexOf('?') > -1 ? '&' : '?') + 'gtbabel_translate_part=1';
      fetch(url, {
        method: 'POST',
        body: data,
        cache: 'no-cache'
      }).then(result => {
        return result.json();
      }).catch(error => {
        return {
          success: false,
          message: error
        };
      }).then(result => {
        resolve(result);
      });
    });
  }

  isExcluded(node) {
    for (let exclude__value of this.exclude) {
      if (exclude__value.contains(node)) {
        return true;
      }
    }

    return false;
  }

}

exports.default = DetectChanges;

},{"diff-dom":4}],2:[function(require,module,exports){
"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _DetectChanges = _interopRequireDefault(require("./DetectChanges"));

const d = new _DetectChanges.default();
document.addEventListener('DOMContentLoaded', () => {
  d.init();
});

},{"./DetectChanges":1,"@babel/runtime/helpers/interopRequireDefault":3}],3:[function(require,module,exports){
function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : {
    "default": obj
  };
}

module.exports = _interopRequireDefault;
},{}],4:[function(require,module,exports){
"use strict";function objToNode(e,t,o){var n;return"#text"===e.nodeName?n=o.document.createTextNode(e.data):"#comment"===e.nodeName?n=o.document.createComment(e.data):("svg"===e.nodeName||t?(n=o.document.createElementNS("http://www.w3.org/2000/svg",e.nodeName),t=!0):n=o.document.createElement(e.nodeName),e.attributes&&Object.entries(e.attributes).forEach(function(e){var t=e[0],o=e[1];return n.setAttribute(t,o)}),e.childNodes&&e.childNodes.forEach(function(e){return n.appendChild(objToNode(e,t,o))}),o.valueDiffing&&(e.value&&(n.value=e.value),e.checked&&(n.checked=e.checked),e.selected&&(n.selected=e.selected))),n}function getFromRoute(e,t){for(t=t.slice();t.length>0;){if(!e.childNodes)return!1;var o=t.splice(0,1)[0];e=e.childNodes[o]}return e}function applyDiff(e,t,o){var n,s,i,a,l=getFromRoute(e,t[o._const.route]),r={diff:t,node:l};if(o.preDiffApply(r))return!0;switch(t[o._const.action]){case o._const.addAttribute:if(!l||!l.setAttribute)return!1;l.setAttribute(t[o._const.name],t[o._const.value]);break;case o._const.modifyAttribute:if(!l||!l.setAttribute)return!1;l.setAttribute(t[o._const.name],t[o._const.newValue]),"INPUT"===l.nodeName&&"value"===t[o._const.name]&&(l.value=t[o._const.newValue]);break;case o._const.removeAttribute:if(!l||!l.removeAttribute)return!1;l.removeAttribute(t[o._const.name]);break;case o._const.modifyTextElement:if(!l||3!==l.nodeType)return!1;o.textDiff(l,l.data,t[o._const.oldValue],t[o._const.newValue]);break;case o._const.modifyValue:if(!l||void 0===l.value)return!1;l.value=t[o._const.newValue];break;case o._const.modifyComment:if(!l||void 0===l.data)return!1;o.textDiff(l,l.data,t[o._const.oldValue],t[o._const.newValue]);break;case o._const.modifyChecked:if(!l||void 0===l.checked)return!1;l.checked=t[o._const.newValue];break;case o._const.modifySelected:if(!l||void 0===l.selected)return!1;l.selected=t[o._const.newValue];break;case o._const.replaceElement:l.parentNode.replaceChild(objToNode(t[o._const.newValue],"http://www.w3.org/2000/svg"===l.namespaceURI,o),l);break;case o._const.relocateGroup:Array.apply(void 0,new Array(t.groupLength)).map(function(){return l.removeChild(l.childNodes[t[o._const.from]])}).forEach(function(e,n){0===n&&(s=l.childNodes[t[o._const.to]]),l.insertBefore(e,s||null)});break;case o._const.removeElement:l.parentNode.removeChild(l);break;case o._const.addElement:a=(i=t[o._const.route].slice()).splice(i.length-1,1)[0],(l=getFromRoute(e,i)).insertBefore(objToNode(t[o._const.element],"http://www.w3.org/2000/svg"===l.namespaceURI,o),l.childNodes[a]||null);break;case o._const.removeTextElement:if(!l||3!==l.nodeType)return!1;l.parentNode.removeChild(l);break;case o._const.addTextElement:if(a=(i=t[o._const.route].slice()).splice(i.length-1,1)[0],n=o.document.createTextNode(t[o._const.value]),!(l=getFromRoute(e,i))||!l.childNodes)return!1;l.insertBefore(n,l.childNodes[a]||null);break;default:console.log("unknown action")}return r.newNode=n,o.postDiffApply(r),!0}function applyDOM(e,t,o){return t.every(function(t){return applyDiff(e,t,o)})}function swap(e,t,o){var n=e[t];e[t]=e[o],e[o]=n}function undoDiff(e,t,o){switch(t[o._const.action]){case o._const.addAttribute:t[o._const.action]=o._const.removeAttribute,applyDiff(e,t,o);break;case o._const.modifyAttribute:swap(t,o._const.oldValue,o._const.newValue),applyDiff(e,t,o);break;case o._const.removeAttribute:t[o._const.action]=o._const.addAttribute,applyDiff(e,t,o);break;case o._const.modifyTextElement:case o._const.modifyValue:case o._const.modifyComment:case o._const.modifyChecked:case o._const.modifySelected:case o._const.replaceElement:swap(t,o._const.oldValue,o._const.newValue),applyDiff(e,t,o);break;case o._const.relocateGroup:swap(t,o._const.from,o._const.to),applyDiff(e,t,o);break;case o._const.removeElement:t[o._const.action]=o._const.addElement,applyDiff(e,t,o);break;case o._const.addElement:t[o._const.action]=o._const.removeElement,applyDiff(e,t,o);break;case o._const.removeTextElement:t[o._const.action]=o._const.addTextElement,applyDiff(e,t,o);break;case o._const.addTextElement:t[o._const.action]=o._const.removeTextElement,applyDiff(e,t,o);break;default:console.log("unknown action")}}function undoDOM(e,t,o){t.length||(t=[t]),(t=t.slice()).reverse(),t.forEach(function(t){undoDiff(e,t,o)})}Object.defineProperty(exports,"__esModule",{value:!0});var Diff=function(e){var t=this;void 0===e&&(e={}),Object.entries(e).forEach(function(e){var o=e[0],n=e[1];return t[o]=n})};function elementDescriptors(e){var t=[];return"#text"!==e.nodeName&&"#comment"!==e.nodeName&&(t.push(e.nodeName),e.attributes&&(e.attributes.class&&t.push(e.nodeName+"."+e.attributes.class.replace(/ /g,".")),e.attributes.id&&t.push(e.nodeName+"#"+e.attributes.id))),t}function findUniqueDescriptors(e){var t={},o={};return e.forEach(function(e){elementDescriptors(e).forEach(function(e){var n=e in t;n||e in o?n&&(delete t[e],o[e]=!0):t[e]=!0})}),t}function uniqueInBoth(e,t){var o=findUniqueDescriptors(e),n=findUniqueDescriptors(t),s={};return Object.keys(o).forEach(function(e){n[e]&&(s[e]=!0)}),s}function removeDone(e){return delete e.outerDone,delete e.innerDone,delete e.valueDone,!e.childNodes||e.childNodes.every(removeDone)}function isEqual(e,t){if(!["nodeName","value","checked","selected","data"].every(function(o){return e[o]===t[o]}))return!1;if(Boolean(e.attributes)!==Boolean(t.attributes))return!1;if(Boolean(e.childNodes)!==Boolean(t.childNodes))return!1;if(e.attributes){var o=Object.keys(e.attributes),n=Object.keys(t.attributes);if(o.length!==n.length)return!1;if(!o.every(function(o){return e.attributes[o]===t.attributes[o]}))return!1}if(e.childNodes){if(e.childNodes.length!==t.childNodes.length)return!1;if(!e.childNodes.every(function(e,o){return isEqual(e,t.childNodes[o])}))return!1}return!0}function roughlyEqual(e,t,o,n,s){if(!e||!t)return!1;if(e.nodeName!==t.nodeName)return!1;if("#text"===e.nodeName)return!!s||e.data===t.data;if(e.nodeName in o)return!0;if(e.attributes&&t.attributes){if(e.attributes.id){if(e.attributes.id!==t.attributes.id)return!1;if(e.nodeName+"#"+e.attributes.id in o)return!0}if(e.attributes.class&&e.attributes.class===t.attributes.class)if(e.nodeName+"."+e.attributes.class.replace(/ /g,".")in o)return!0}if(n)return!0;var i=e.childNodes?e.childNodes.slice().reverse():[],a=t.childNodes?t.childNodes.slice().reverse():[];if(i.length!==a.length)return!1;if(s)return i.every(function(e,t){return e.nodeName===a[t].nodeName});var l=uniqueInBoth(i,a);return i.every(function(e,t){return roughlyEqual(e,a[t],l,!0,!0)})}function cloneObj(e){return JSON.parse(JSON.stringify(e))}function findCommonSubsets(e,t,o,n){var s=0,i=[],a=e.length,l=t.length,r=Array.apply(void 0,new Array(a+1)).map(function(){return[]}),c=uniqueInBoth(e,t),u=a===l;u&&e.some(function(e,o){var n=elementDescriptors(e),s=elementDescriptors(t[o]);return n.length!==s.length?(u=!1,!0):(n.some(function(e,t){if(e!==s[t])return u=!1,!0}),!u||void 0)});for(var d=0;d<a;d++)for(var f=e[d],h=0;h<l;h++){var p=t[h];o[d]||n[h]||!roughlyEqual(f,p,c,u)?r[d+1][h+1]=0:(r[d+1][h+1]=r[d][h]?r[d][h]+1:1,r[d+1][h+1]>=s&&(s=r[d+1][h+1],i=[d+1,h+1]))}return 0!==s&&{oldValue:i[0]-s,newValue:i[1]-s,length:s}}function makeArray(e,t){return Array.apply(void 0,new Array(e)).map(function(){return t})}function getGapInformation(e,t,o){var n=e.childNodes?makeArray(e.childNodes.length,!0):[],s=t.childNodes?makeArray(t.childNodes.length,!0):[],i=0;return o.forEach(function(e){for(var t=e.oldValue+e.length,o=e.newValue+e.length,a=e.oldValue;a<t;a+=1)n[a]=i;for(var l=e.newValue;l<o;l+=1)s[l]=i;i+=1}),{gaps1:n,gaps2:s}}function markSubTrees(e,t){for(var o=e.childNodes?e.childNodes:[],n=t.childNodes?t.childNodes:[],s=makeArray(o.length,!1),i=makeArray(n.length,!1),a=[],l=!0,r=function(){return arguments[1]};l;){if(l=findCommonSubsets(o,n,s,i))a.push(l),Array.apply(void 0,new Array(l.length)).map(r).forEach(function(e){return t=e,s[l.oldValue+t]=!0,void(i[l.newValue+t]=!0);var t})}return e.subsets=a,e.subsetsAge=100,a}Diff.prototype.toString=function(){return JSON.stringify(this)},Diff.prototype.setValue=function(e,t){return this[e]=t,this};var DiffTracker=function(){this.list=[]};function getFromVirtualRoute(e,t){var o,n,s=e;for(t=t.slice();t.length>0;){if(!s.childNodes)return!1;n=t.splice(0,1)[0],o=s,s=s.childNodes[n]}return{node:s,parentNode:o,nodeIndex:n}}function applyVirtualDiff(e,t,o){var n,s,i,a=getFromVirtualRoute(e,t[o._const.route]),l=a.node,r=a.parentNode,c=a.nodeIndex,u=[],d={diff:t,node:l};if(o.preDiffApply(d))return!0;switch(t[o._const.action]){case o._const.addAttribute:l.attributes||(l.attributes={}),l.attributes[t[o._const.name]]=t[o._const.value],"checked"===t[o._const.name]?l.checked=!0:"selected"===t[o._const.name]?l.selected=!0:"INPUT"===l.nodeName&&"value"===t[o._const.name]&&(l.value=t[o._const.value]);break;case o._const.modifyAttribute:l.attributes[t[o._const.name]]=t[o._const.newValue];break;case o._const.removeAttribute:delete l.attributes[t[o._const.name]],0===Object.keys(l.attributes).length&&delete l.attributes,"checked"===t[o._const.name]?l.checked=!1:"selected"===t[o._const.name]?delete l.selected:"INPUT"===l.nodeName&&"value"===t[o._const.name]&&delete l.value;break;case o._const.modifyTextElement:l.data=t[o._const.newValue];break;case o._const.modifyValue:l.value=t[o._const.newValue];break;case o._const.modifyComment:l.data=t[o._const.newValue];break;case o._const.modifyChecked:l.checked=t[o._const.newValue];break;case o._const.modifySelected:l.selected=t[o._const.newValue];break;case o._const.replaceElement:(n=cloneObj(t[o._const.newValue])).outerDone=!0,n.innerDone=!0,n.valueDone=!0,r.childNodes[c]=n;break;case o._const.relocateGroup:l.childNodes.splice(t[o._const.from],t.groupLength).reverse().forEach(function(e){return l.childNodes.splice(t[o._const.to],0,e)}),l.subsets&&l.subsets.forEach(function(e){if(t[o._const.from]<t[o._const.to]&&e.oldValue<=t[o._const.to]&&e.oldValue>t[o._const.from]){e.oldValue-=t.groupLength;var n=e.oldValue+e.length-t[o._const.to];n>0&&(u.push({oldValue:t[o._const.to]+t.groupLength,newValue:e.newValue+e.length-n,length:n}),e.length-=n)}else if(t[o._const.from]>t[o._const.to]&&e.oldValue>t[o._const.to]&&e.oldValue<t[o._const.from]){e.oldValue+=t.groupLength;var s=e.oldValue+e.length-t[o._const.to];s>0&&(u.push({oldValue:t[o._const.to]+t.groupLength,newValue:e.newValue+e.length-s,length:s}),e.length-=s)}else e.oldValue===t[o._const.from]&&(e.oldValue=t[o._const.to])});break;case o._const.removeElement:r.childNodes.splice(c,1),r.subsets&&r.subsets.forEach(function(e){e.oldValue>c?e.oldValue-=1:e.oldValue===c?e.delete=!0:e.oldValue<c&&e.oldValue+e.length>c&&(e.oldValue+e.length-1===c?e.length--:(u.push({newValue:e.newValue+c-e.oldValue,oldValue:c,length:e.length-c+e.oldValue-1}),e.length=c-e.oldValue))}),l=r;break;case o._const.addElement:s=t[o._const.route].slice(),i=s.splice(s.length-1,1)[0],l=getFromVirtualRoute(e,s).node,(n=cloneObj(t[o._const.element])).outerDone=!0,n.innerDone=!0,n.valueDone=!0,l.childNodes||(l.childNodes=[]),i>=l.childNodes.length?l.childNodes.push(n):l.childNodes.splice(i,0,n),l.subsets&&l.subsets.forEach(function(e){if(e.oldValue>=i)e.oldValue+=1;else if(e.oldValue<i&&e.oldValue+e.length>i){var t=e.oldValue+e.length-i;u.push({newValue:e.newValue+e.length-t,oldValue:i+1,length:t}),e.length-=t}});break;case o._const.removeTextElement:r.childNodes.splice(c,1),"TEXTAREA"===r.nodeName&&delete r.value,r.subsets&&r.subsets.forEach(function(e){e.oldValue>c?e.oldValue-=1:e.oldValue===c?e.delete=!0:e.oldValue<c&&e.oldValue+e.length>c&&(e.oldValue+e.length-1===c?e.length--:(u.push({newValue:e.newValue+c-e.oldValue,oldValue:c,length:e.length-c+e.oldValue-1}),e.length=c-e.oldValue))}),l=r;break;case o._const.addTextElement:s=t[o._const.route].slice(),i=s.splice(s.length-1,1)[0],(n={}).nodeName="#text",n.data=t[o._const.value],(l=getFromVirtualRoute(e,s).node).childNodes||(l.childNodes=[]),i>=l.childNodes.length?l.childNodes.push(n):l.childNodes.splice(i,0,n),"TEXTAREA"===l.nodeName&&(l.value=t[o._const.newValue]),l.subsets&&l.subsets.forEach(function(e){if(e.oldValue>=i&&(e.oldValue+=1),e.oldValue<i&&e.oldValue+e.length>i){var t=e.oldValue+e.length-i;u.push({newValue:e.newValue+e.length-t,oldValue:i+1,length:t}),e.length-=t}});break;default:console.log("unknown action")}l.subsets&&(l.subsets=l.subsets.filter(function(e){return!e.delete&&e.oldValue!==e.newValue}),u.length&&(l.subsets=l.subsets.concat(u))),d.newNode=n,o.postDiffApply(d)}function applyVirtual(e,t,o){return t.forEach(function(t){applyVirtualDiff(e,t,o)}),!0}function nodeToObj(e,t){void 0===t&&(t={});var o={};if(o.nodeName=e.nodeName,"#text"===o.nodeName||"#comment"===o.nodeName)o.data=e.data;else{if(e.attributes&&e.attributes.length>0)o.attributes={},Array.prototype.slice.call(e.attributes).forEach(function(e){return o.attributes[e.name]=e.value});if("TEXTAREA"===o.nodeName)o.value=e.value;else if(e.childNodes&&e.childNodes.length>0){o.childNodes=[],Array.prototype.slice.call(e.childNodes).forEach(function(e){return o.childNodes.push(nodeToObj(e,t))})}t.valueDiffing&&(void 0!==e.checked&&e.type&&["radio","checkbox"].includes(e.type.toLowerCase())?o.checked=e.checked:void 0!==e.value&&(o.value=e.value),void 0!==e.selected&&(o.selected=e.selected))}return o}DiffTracker.prototype.add=function(e){var t;(t=this.list).push.apply(t,e)},DiffTracker.prototype.forEach=function(e){this.list.forEach(function(t){return e(t)})};var tagRE=/<(?:"[^"]*"['"]*|'[^']*'['"]*|[^'">])+>/g,empty=Object.create?Object.create(null):{},attrRE=/\s([^'"\/\s><]+?)[\s\/>]|([^\s=]+)=\s?(".*?"|'.*?')/g;function unescape(e){return e.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")}var lookup={area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,menuItem:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0};function parseTag(e){var t={nodeName:"",attributes:{}},o=e.match(/<\/?([^\s]+?)[\/\s>]/);o&&(t.nodeName=o[1].toUpperCase(),(lookup[o[1].toLowerCase()]||"/"===e.charAt(e.length-2))&&(t.voidElement=!0));for(var n=new RegExp(attrRE),s=null,i=!1;!i;)if(null===(s=n.exec(e)))i=!0;else if(s[0].trim())if(s[1]){var a=s[1].trim(),l=[a,""];a.indexOf("=")>-1&&(l=a.split("=")),t.attributes[l[0]]=l[1],n.lastIndex--}else s[2]&&(t.attributes[s[2]]=s[3].trim().substring(1,s[3].length-1));return t}function parse(e,t){void 0===t&&(t={components:empty});var o,n=[],s=-1,i=[],a={},l=!1;return e.replace(tagRE,function(r,c){if(l){if(r!=="</"+o.nodeName+">")return;l=!1}var u,d="/"!==r.charAt(1),f=c+r.length,h=e.charAt(f);if(d&&(s++,"tag"===(o=parseTag(r)).type&&t.components[o.nodeName]&&(o.type="component",l=!0),o.voidElement||l||!h||"<"===h||(o.childNodes||(o.childNodes=[]),o.childNodes.push({nodeName:"#text",data:unescape(e.slice(f,e.indexOf("<",f)))})),a[o.tagName]=o,0===s&&n.push(o),(u=i[s-1])&&(u.childNodes||(u.childNodes=[]),u.childNodes.push(o)),i[s]=o),(!d||o.voidElement)&&(s--,!l&&"<"!==h&&h)){u=-1===s?n:i[s].childNodes||[];var p=e.indexOf("<",f),m=unescape(e.slice(f,-1===p?void 0:p));u.push({nodeName:"#text",data:m})}}),n[0]}function cleanObj(e){return delete e.voidElement,e.childNodes&&e.childNodes.forEach(function(e){return cleanObj(e)}),e}function stringToObj(e){return cleanObj(parse(e))}var DiffFinder=function(e,t,o){this.options=o,this.t1=e instanceof HTMLElement?nodeToObj(e,this.options):"string"==typeof e?stringToObj(e,this.options):JSON.parse(JSON.stringify(e)),this.t2=t instanceof HTMLElement?nodeToObj(t,this.options):"string"==typeof t?stringToObj(t,this.options):JSON.parse(JSON.stringify(t)),this.diffcount=0,this.foundAll=!1,this.debug&&(this.t1Orig=nodeToObj(e,this.options),this.t2Orig=nodeToObj(t,this.options)),this.tracker=new DiffTracker};DiffFinder.prototype.init=function(){return this.findDiffs(this.t1,this.t2)},DiffFinder.prototype.findDiffs=function(e,t){var o;do{if(this.options.debug&&(this.diffcount+=1,this.diffcount>this.options.diffcap))throw window.diffError=[this.t1Orig,this.t2Orig],new Error("surpassed diffcap:"+JSON.stringify(this.t1Orig)+" -> "+JSON.stringify(this.t2Orig));0===(o=this.findNextDiff(e,t,[])).length&&(isEqual(e,t)||(this.foundAll?console.error("Could not find remaining diffs!"):(this.foundAll=!0,removeDone(e),o=this.findNextDiff(e,t,[])))),o.length>0&&(this.foundAll=!1,this.tracker.add(o),applyVirtual(e,o,this.options))}while(o.length>0);return this.tracker.list},DiffFinder.prototype.findNextDiff=function(e,t,o){var n,s;if(this.options.maxDepth&&o.length>this.options.maxDepth)return[];if(!e.outerDone){if(n=this.findOuterDiff(e,t,o),this.options.filterOuterDiff&&(s=this.options.filterOuterDiff(e,t,n))&&(n=s),n.length>0)return e.outerDone=!0,n;e.outerDone=!0}if(!e.innerDone){if((n=this.findInnerDiff(e,t,o)).length>0)return n;e.innerDone=!0}if(this.options.valueDiffing&&!e.valueDone){if((n=this.findValueDiff(e,t,o)).length>0)return e.valueDone=!0,n;e.valueDone=!0}return[]},DiffFinder.prototype.findOuterDiff=function(e,t,o){var n,s,i,a,l,r,c=[];if(e.nodeName!==t.nodeName){if(!o.length)throw new Error("Top level nodes have to be of the same kind.");return[(new Diff).setValue(this.options._const.action,this.options._const.replaceElement).setValue(this.options._const.oldValue,cloneObj(e)).setValue(this.options._const.newValue,cloneObj(t)).setValue(this.options._const.route,o)]}if(o.length&&this.options.maxNodeDiffCount<Math.abs((e.childNodes||[]).length-(t.childNodes||[]).length))return[(new Diff).setValue(this.options._const.action,this.options._const.replaceElement).setValue(this.options._const.oldValue,cloneObj(e)).setValue(this.options._const.newValue,cloneObj(t)).setValue(this.options._const.route,o)];if(e.data!==t.data)return"#text"===e.nodeName?[(new Diff).setValue(this.options._const.action,this.options._const.modifyTextElement).setValue(this.options._const.route,o).setValue(this.options._const.oldValue,e.data).setValue(this.options._const.newValue,t.data)]:[(new Diff).setValue(this.options._const.action,this.options._const.modifyComment).setValue(this.options._const.route,o).setValue(this.options._const.oldValue,e.data).setValue(this.options._const.newValue,t.data)];for(s=e.attributes?Object.keys(e.attributes).sort():[],i=t.attributes?Object.keys(t.attributes).sort():[],a=s.length,r=0;r<a;r++)n=s[r],-1===(l=i.indexOf(n))?c.push((new Diff).setValue(this.options._const.action,this.options._const.removeAttribute).setValue(this.options._const.route,o).setValue(this.options._const.name,n).setValue(this.options._const.value,e.attributes[n])):(i.splice(l,1),e.attributes[n]!==t.attributes[n]&&c.push((new Diff).setValue(this.options._const.action,this.options._const.modifyAttribute).setValue(this.options._const.route,o).setValue(this.options._const.name,n).setValue(this.options._const.oldValue,e.attributes[n]).setValue(this.options._const.newValue,t.attributes[n])));for(a=i.length,r=0;r<a;r++)n=i[r],c.push((new Diff).setValue(this.options._const.action,this.options._const.addAttribute).setValue(this.options._const.route,o).setValue(this.options._const.name,n).setValue(this.options._const.value,t.attributes[n]));return c},DiffFinder.prototype.findInnerDiff=function(e,t,o){var n=e.childNodes?e.childNodes.slice():[],s=t.childNodes?t.childNodes.slice():[],i=Math.max(n.length,s.length),a=Math.abs(n.length-s.length),l=[],r=0;if(!this.options.maxChildCount||i<this.options.maxChildCount){var c=e.subsets&&e.subsetsAge--?e.subsets:e.childNodes&&t.childNodes?markSubTrees(e,t):[];if(c.length>0&&(l=this.attemptGroupRelocation(e,t,c,o)).length>0)return l}for(var u=0;u<i;u+=1){var d=n[u],f=s[u];a&&(d&&!f?"#text"===d.nodeName?(l.push((new Diff).setValue(this.options._const.action,this.options._const.removeTextElement).setValue(this.options._const.route,o.concat(r)).setValue(this.options._const.value,d.data)),r-=1):(l.push((new Diff).setValue(this.options._const.action,this.options._const.removeElement).setValue(this.options._const.route,o.concat(r)).setValue(this.options._const.element,cloneObj(d))),r-=1):f&&!d&&("#text"===f.nodeName?l.push((new Diff).setValue(this.options._const.action,this.options._const.addTextElement).setValue(this.options._const.route,o.concat(r)).setValue(this.options._const.value,f.data)):l.push((new Diff).setValue(this.options._const.action,this.options._const.addElement).setValue(this.options._const.route,o.concat(r)).setValue(this.options._const.element,cloneObj(f))))),d&&f&&(!this.options.maxChildCount||i<this.options.maxChildCount?l=l.concat(this.findNextDiff(d,f,o.concat(r))):isEqual(d,f)||(n.length>s.length?(l=l.concat([(new Diff).setValue(this.options._const.action,this.options._const.removeElement).setValue(this.options._const.element,cloneObj(d)).setValue(this.options._const.route,o.concat(r))]),n.splice(u,1),r-=1,a-=1):n.length<s.length?(l=l.concat([(new Diff).setValue(this.options._const.action,this.options._const.addElement).setValue(this.options._const.element,cloneObj(f)).setValue(this.options._const.route,o.concat(r))]),n.splice(u,0,{}),a-=1):l=l.concat([(new Diff).setValue(this.options._const.action,this.options._const.replaceElement).setValue(this.options._const.oldValue,cloneObj(d)).setValue(this.options._const.newValue,cloneObj(f)).setValue(this.options._const.route,o.concat(r))]))),r+=1}return e.innerDone=!0,l},DiffFinder.prototype.attemptGroupRelocation=function(e,t,o,n){for(var s,i,a,l,r,c,u=getGapInformation(e,t,o),d=u.gaps1,f=u.gaps2,h=Math.min(d.length,f.length),p=[],m=0,g=0;m<h;g+=1,m+=1)if(!0===d[m])if("#text"===(l=e.childNodes[g]).nodeName){if("#text"===t.childNodes[m].nodeName&&l.data!==t.childNodes[m].data){for(c=g;e.childNodes.length>c+1&&"#text"===e.childNodes[c+1].nodeName;)if(c+=1,t.childNodes[m].data===e.childNodes[c].data){r=!0;break}if(!r)return p.push((new Diff).setValue(this.options._const.action,this.options._const.modifyTextElement).setValue(this.options._const.route,n.concat(m)).setValue(this.options._const.oldValue,l.data).setValue(this.options._const.newValue,t.childNodes[m].data)),p}p.push((new Diff).setValue(this.options._const.action,this.options._const.removeTextElement).setValue(this.options._const.route,n.concat(m)).setValue(this.options._const.value,l.data)),d.splice(m,1),h=Math.min(d.length,f.length),m-=1}else p.push((new Diff).setValue(this.options._const.action,this.options._const.removeElement).setValue(this.options._const.route,n.concat(m)).setValue(this.options._const.element,cloneObj(l))),d.splice(m,1),h=Math.min(d.length,f.length),m-=1;else if(!0===f[m])"#text"===(l=t.childNodes[m]).nodeName?(p.push((new Diff).setValue(this.options._const.action,this.options._const.addTextElement).setValue(this.options._const.route,n.concat(m)).setValue(this.options._const.value,l.data)),d.splice(m,0,!0),h=Math.min(d.length,f.length),g-=1):(p.push((new Diff).setValue(this.options._const.action,this.options._const.addElement).setValue(this.options._const.route,n.concat(m)).setValue(this.options._const.element,cloneObj(l))),d.splice(m,0,!0),h=Math.min(d.length,f.length),g-=1);else if(d[m]!==f[m]){if(p.length>0)return p;if(a=o[d[m]],(i=Math.min(a.newValue,e.childNodes.length-a.length))!==a.oldValue){s=!1;for(var _=0;_<a.length;_+=1)roughlyEqual(e.childNodes[i+_],e.childNodes[a.oldValue+_],[],!1,!0)||(s=!0);if(s)return[(new Diff).setValue(this.options._const.action,this.options._const.relocateGroup).setValue("groupLength",a.length).setValue(this.options._const.from,a.oldValue).setValue(this.options._const.to,i).setValue(this.options._const.route,n)]}}return p},DiffFinder.prototype.findValueDiff=function(e,t,o){var n=[];return e.selected!==t.selected&&n.push((new Diff).setValue(this.options._const.action,this.options._const.modifySelected).setValue(this.options._const.oldValue,e.selected).setValue(this.options._const.newValue,t.selected).setValue(this.options._const.route,o)),(e.value||t.value)&&e.value!==t.value&&"OPTION"!==e.nodeName&&n.push((new Diff).setValue(this.options._const.action,this.options._const.modifyValue).setValue(this.options._const.oldValue,e.value||"").setValue(this.options._const.newValue,t.value||"").setValue(this.options._const.route,o)),e.checked!==t.checked&&n.push((new Diff).setValue(this.options._const.action,this.options._const.modifyChecked).setValue(this.options._const.oldValue,e.checked).setValue(this.options._const.newValue,t.checked).setValue(this.options._const.route,o)),n};var DEFAULT_OPTIONS={debug:!1,diffcap:10,maxDepth:!1,maxChildCount:50,valueDiffing:!0,textDiff:function(e,t,o,n){e.data=n},preVirtualDiffApply:function(){},postVirtualDiffApply:function(){},preDiffApply:function(){},postDiffApply:function(){},filterOuterDiff:null,compress:!1,_const:!1,document:!(!window||!window.document)&&window.document},DiffDOM=function(e){var t=this;if(void 0===e&&(e={}),this.options=e,Object.entries(DEFAULT_OPTIONS).forEach(function(e){var o=e[0],n=e[1];Object.prototype.hasOwnProperty.call(t.options,o)||(t.options[o]=n)}),!this.options._const){var o=["addAttribute","modifyAttribute","removeAttribute","modifyTextElement","relocateGroup","removeElement","addElement","removeTextElement","addTextElement","replaceElement","modifyValue","modifyChecked","modifySelected","modifyComment","action","route","oldValue","newValue","element","group","from","to","name","value","data","attributes","nodeName","childNodes","checked","selected"];this.options._const={},this.options.compress?o.forEach(function(e,o){return t.options._const[e]=o}):o.forEach(function(e){return t.options._const[e]=e})}this.DiffFinder=DiffFinder};DiffDOM.prototype.apply=function(e,t){return applyDOM(e,t,this.options)},DiffDOM.prototype.undo=function(e,t){return undoDOM(e,t,this.options)},DiffDOM.prototype.diff=function(e,t){return new this.DiffFinder(e,t,this.options).init()};var TraceLogger=function(e){var t=this;void 0===e&&(e={}),this.pad="│   ",this.padding="",this.tick=1,this.messages=[];var o=function(e,o){var n=e[o];e[o]=function(){for(var s=[],i=arguments.length;i--;)s[i]=arguments[i];t.fin(o,Array.prototype.slice.call(s));var a=n.apply(e,s);return t.fout(o,a),a}};for(var n in e)"function"==typeof e[n]&&o(e,n);this.log("┌ TRACELOG START")};TraceLogger.prototype.fin=function(e,t){this.padding+=this.pad,this.log("├─> entering "+e,t)},TraceLogger.prototype.fout=function(e,t){this.log("│<──┘ generated return value",t),this.padding=this.padding.substring(0,this.padding.length-this.pad.length)},TraceLogger.prototype.format=function(e,t){return function(e){for(e=""+e;e.length<4;)e="0"+e;return e}(t)+"> "+this.padding+e},TraceLogger.prototype.log=function(){var e=Array.prototype.slice.call(arguments),t=function(e){return e?"string"==typeof e?e:e instanceof HTMLElement?e.outerHTML||"<empty>":e instanceof Array?"["+e.map(t).join(",")+"]":e.toString()||e.valueOf()||"<unknown>":"<falsey>"};e=e.map(t).join(", "),this.messages.push(this.format(e,this.tick++))},TraceLogger.prototype.toString=function(){for(var e="└───";e.length<=this.padding.length+this.pad.length;)e+="×   ";var t=this.padding;return this.padding="",e=this.format(e,this.tick),this.padding=t,this.messages.join("\n")+"\n"+e},exports.DiffDOM=DiffDOM,exports.TraceLogger=TraceLogger,exports.nodeToObj=nodeToObj,exports.stringToObj=stringToObj;


},{}]},{},[2])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJqcy9mcm9udGVuZC9EZXRlY3RDaGFuZ2VzLmpzIiwianMvZnJvbnRlbmQvc2NyaXB0LmpzIiwibm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvaW50ZXJvcFJlcXVpcmVEZWZhdWx0LmpzIiwibm9kZV9tb2R1bGVzL2RpZmYtZG9tL2Rpc3QvaW5kZXguanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7Ozs7O0FDQUE7O0FBRWUsTUFBTSxhQUFOLENBQW9CO0FBQy9CLEVBQUEsV0FBVyxHQUFHO0FBQ1YsU0FBSyxRQUFMLEdBQWdCLElBQWhCO0FBQ0EsU0FBSyxPQUFMLEdBQWUsRUFBZjtBQUNBLFNBQUssRUFBTCxHQUFVLElBQUksZ0JBQUosRUFBVjtBQUNIOztBQUVELFFBQU0sSUFBTixHQUFhO0FBQ1QsU0FBSyxxQkFBTDtBQUNIOztBQUVELEVBQUEscUJBQXFCLEdBQUc7QUFDcEIsU0FBSyxRQUFMLEdBQWdCLElBQUksZ0JBQUosQ0FBcUIsU0FBUyxJQUFJO0FBQzlDLE1BQUEsU0FBUyxDQUFDLE9BQVYsQ0FBa0IsZ0JBQWdCLElBQUk7QUFDbEMsYUFBSyxXQUFMLENBQWlCLGdCQUFqQjtBQUNILE9BRkQ7QUFHSCxLQUplLEVBSWIsT0FKYSxDQUlMLFFBQVEsQ0FBQyxJQUpKLEVBSVU7QUFDdEIsTUFBQSxTQUFTLEVBQUUsSUFEVztBQUV0QixNQUFBLFVBQVUsRUFBRSxLQUZVO0FBR3RCLE1BQUEsYUFBYSxFQUFFLElBSE87QUFJdEIsTUFBQSxPQUFPLEVBQUU7QUFKYSxLQUpWLENBQWhCO0FBVUg7O0FBRUQsUUFBTSxXQUFOLENBQWtCLFFBQWxCLEVBQTRCO0FBQ3hCLFFBQUksS0FBSyxHQUFHLEVBQVo7O0FBQ0EsUUFBSSxRQUFRLENBQUMsVUFBVCxDQUFvQixNQUFwQixHQUE2QixDQUFqQyxFQUFvQztBQUNoQyxNQUFBLEtBQUssR0FBRyxRQUFRLENBQUMsVUFBakI7QUFDSCxLQUZELE1BRU8sSUFBSSxRQUFRLENBQUMsWUFBVCxDQUFzQixNQUF0QixLQUFpQyxDQUFqQyxJQUFzQyxRQUFRLENBQUMsTUFBVCxLQUFvQixJQUE5RCxFQUFvRTtBQUN2RSxNQUFBLEtBQUssR0FBRyxDQUFDLFFBQVEsQ0FBQyxNQUFWLENBQVI7QUFDSDs7QUFDRCxRQUFJLEtBQUssQ0FBQyxNQUFOLEtBQWlCLENBQXJCLEVBQXdCO0FBQ3BCO0FBQ0g7O0FBQ0QsU0FBSyxJQUFJLFlBQVQsSUFBeUIsS0FBekIsRUFBZ0M7QUFDNUIsVUFBSSxLQUFLLFVBQUwsQ0FBZ0IsWUFBaEIsQ0FBSixFQUFtQztBQUMvQjtBQUNIOztBQUNELFVBQUksWUFBWSxDQUFDLFFBQWIsSUFBeUIsQ0FBekIsSUFBOEIsWUFBWSxDQUFDLFFBQWIsSUFBeUIsQ0FBM0QsRUFBOEQ7QUFDMUQ7QUFDSDs7QUFDRCxVQUFJLFlBQVksQ0FBQyxRQUFiLElBQXlCLENBQTdCLEVBQWdDO0FBQzVCLFFBQUEsWUFBWSxHQUFHLFlBQVksQ0FBQyxVQUE1QjtBQUNIOztBQUNELFVBQUksWUFBWSxDQUFDLE9BQWIsS0FBeUIsTUFBN0IsRUFBcUM7QUFDakM7QUFDSDs7QUFDRCxVQUFJLElBQUksR0FBRyxFQUFYLENBYjRCLENBYzVCOztBQUNBLE1BQUEsWUFBWSxDQUFDLGVBQWIsQ0FBNkIsbUJBQTdCO0FBQ0EsTUFBQSxJQUFJLEdBQUcsWUFBWSxDQUFDLFNBQXBCO0FBQ0EsTUFBQSxZQUFZLENBQUMsWUFBYixDQUEwQixtQkFBMUIsRUFBK0MsRUFBL0M7QUFDQSxVQUFJLElBQUksR0FBRyxNQUFNLEtBQUssY0FBTCxDQUFvQixJQUFwQixDQUFqQjtBQUNBLE1BQUEsT0FBTyxDQUFDLEdBQVIsQ0FBWSxJQUFaO0FBQ0EsVUFBSSxLQUFLLEdBQUcsSUFBSSxDQUFDLE9BQUwsS0FBaUIsSUFBakIsR0FBd0IsSUFBSSxDQUFDLElBQTdCLEdBQW9DLElBQWhEO0FBQ0EsV0FBSyw0QkFBTCxDQUFrQyxZQUFsQyxFQUFnRCxLQUFoRDtBQUNIO0FBQ0o7O0FBRUQsRUFBQSw0QkFBNEIsQ0FBQyxJQUFELEVBQU8sSUFBUCxFQUFhO0FBQ3JDLFNBQUssT0FBTCxDQUFhLElBQWIsQ0FBa0IsSUFBbEI7QUFDQSxRQUFJLElBQUksR0FBRyxLQUFLLEVBQUwsQ0FBUSxJQUFSLENBQWEsSUFBYixFQUFtQixJQUFuQixDQUFYO0FBQ0EsU0FBSyxFQUFMLENBQVEsS0FBUixDQUFjLElBQWQsRUFBb0IsSUFBcEI7QUFDQSxJQUFBLHFCQUFxQixDQUFDLE1BQU07QUFDeEIsV0FBSyxPQUFMLEdBQWUsS0FBSyxPQUFMLENBQWEsTUFBYixDQUFvQixjQUFjLElBQUksY0FBYyxLQUFLLElBQXpELENBQWY7QUFDSCxLQUZvQixDQUFyQjtBQUdIOztBQUVELEVBQUEsY0FBYyxDQUFDLElBQUQsRUFBTztBQUNqQixXQUFPLElBQUksT0FBSixDQUFZLE9BQU8sSUFBSTtBQUMxQixVQUFJLElBQUksR0FBRyxJQUFJLGVBQUosRUFBWDtBQUNBLE1BQUEsSUFBSSxDQUFDLE1BQUwsQ0FBWSxNQUFaLEVBQW9CLElBQXBCO0FBQ0EsVUFBSSxHQUFHLEdBQUcsTUFBTSxDQUFDLFFBQVAsQ0FBZ0IsUUFBaEIsR0FBMkIsSUFBM0IsR0FBa0MsTUFBTSxDQUFDLFFBQVAsQ0FBZ0IsSUFBbEQsR0FBeUQsTUFBTSxDQUFDLFFBQVAsQ0FBZ0IsUUFBbkY7QUFDQSxNQUFBLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxPQUFKLENBQVksR0FBWixJQUFtQixDQUFDLENBQXBCLEdBQXdCLEdBQXhCLEdBQThCLEdBQS9CLElBQXNDLDBCQUE3QztBQUNBLE1BQUEsS0FBSyxDQUFDLEdBQUQsRUFBTTtBQUNQLFFBQUEsTUFBTSxFQUFFLE1BREQ7QUFFUCxRQUFBLElBQUksRUFBRSxJQUZDO0FBR1AsUUFBQSxLQUFLLEVBQUU7QUFIQSxPQUFOLENBQUwsQ0FLSyxJQUxMLENBS1UsTUFBTSxJQUFJO0FBQ1osZUFBTyxNQUFNLENBQUMsSUFBUCxFQUFQO0FBQ0gsT0FQTCxFQVFLLEtBUkwsQ0FRVyxLQUFLLElBQUk7QUFDWixlQUFPO0FBQUUsVUFBQSxPQUFPLEVBQUUsS0FBWDtBQUFrQixVQUFBLE9BQU8sRUFBRTtBQUEzQixTQUFQO0FBQ0gsT0FWTCxFQVdLLElBWEwsQ0FXVSxNQUFNLElBQUk7QUFDWixRQUFBLE9BQU8sQ0FBQyxNQUFELENBQVA7QUFDSCxPQWJMO0FBY0gsS0FuQk0sQ0FBUDtBQW9CSDs7QUFFRCxFQUFBLFVBQVUsQ0FBQyxJQUFELEVBQU87QUFDYixTQUFLLElBQUksY0FBVCxJQUEyQixLQUFLLE9BQWhDLEVBQXlDO0FBQ3JDLFVBQUksY0FBYyxDQUFDLFFBQWYsQ0FBd0IsSUFBeEIsQ0FBSixFQUFtQztBQUMvQixlQUFPLElBQVA7QUFDSDtBQUNKOztBQUNELFdBQU8sS0FBUDtBQUNIOztBQWxHOEI7Ozs7Ozs7OztBQ0ZuQzs7QUFFQSxNQUFNLENBQUMsR0FBRyxJQUFJLHNCQUFKLEVBQVY7QUFDQSxRQUFRLENBQUMsZ0JBQVQsQ0FBMEIsa0JBQTFCLEVBQThDLE1BQU07QUFDaEQsRUFBQSxDQUFDLENBQUMsSUFBRjtBQUNILENBRkQ7OztBQ0hBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ05BO0FBQ0E7QUFDQSIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uKCl7ZnVuY3Rpb24gcihlLG4sdCl7ZnVuY3Rpb24gbyhpLGYpe2lmKCFuW2ldKXtpZighZVtpXSl7dmFyIGM9XCJmdW5jdGlvblwiPT10eXBlb2YgcmVxdWlyZSYmcmVxdWlyZTtpZighZiYmYylyZXR1cm4gYyhpLCEwKTtpZih1KXJldHVybiB1KGksITApO3ZhciBhPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIraStcIidcIik7dGhyb3cgYS5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGF9dmFyIHA9bltpXT17ZXhwb3J0czp7fX07ZVtpXVswXS5jYWxsKHAuZXhwb3J0cyxmdW5jdGlvbihyKXt2YXIgbj1lW2ldWzFdW3JdO3JldHVybiBvKG58fHIpfSxwLHAuZXhwb3J0cyxyLGUsbix0KX1yZXR1cm4gbltpXS5leHBvcnRzfWZvcih2YXIgdT1cImZ1bmN0aW9uXCI9PXR5cGVvZiByZXF1aXJlJiZyZXF1aXJlLGk9MDtpPHQubGVuZ3RoO2krKylvKHRbaV0pO3JldHVybiBvfXJldHVybiByfSkoKSIsImltcG9ydCB7IERpZmZET00gfSBmcm9tICdkaWZmLWRvbSc7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBEZXRlY3RDaGFuZ2VzIHtcclxuICAgIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgICAgIHRoaXMub2JzZXJ2ZXIgPSBudWxsO1xyXG4gICAgICAgIHRoaXMuZXhjbHVkZSA9IFtdO1xyXG4gICAgICAgIHRoaXMuZGQgPSBuZXcgRGlmZkRPTSgpO1xyXG4gICAgfVxyXG5cclxuICAgIGFzeW5jIGluaXQoKSB7XHJcbiAgICAgICAgdGhpcy5zZXR1cE11dGF0aW9uT2JzZXJ2ZXIoKTtcclxuICAgIH1cclxuXHJcbiAgICBzZXR1cE11dGF0aW9uT2JzZXJ2ZXIoKSB7XHJcbiAgICAgICAgdGhpcy5vYnNlcnZlciA9IG5ldyBNdXRhdGlvbk9ic2VydmVyKG11dGF0aW9ucyA9PiB7XHJcbiAgICAgICAgICAgIG11dGF0aW9ucy5mb3JFYWNoKG11dGF0aW9uc19fdmFsdWUgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5vbkRvbUNoYW5nZShtdXRhdGlvbnNfX3ZhbHVlKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSkub2JzZXJ2ZShkb2N1bWVudC5ib2R5LCB7XHJcbiAgICAgICAgICAgIGNoaWxkTGlzdDogdHJ1ZSxcclxuICAgICAgICAgICAgYXR0cmlidXRlczogZmFsc2UsXHJcbiAgICAgICAgICAgIGNoYXJhY3RlckRhdGE6IHRydWUsXHJcbiAgICAgICAgICAgIHN1YnRyZWU6IHRydWVcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBhc3luYyBvbkRvbUNoYW5nZShtdXRhdGlvbikge1xyXG4gICAgICAgIGxldCBub2RlcyA9IFtdO1xyXG4gICAgICAgIGlmIChtdXRhdGlvbi5hZGRlZE5vZGVzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgbm9kZXMgPSBtdXRhdGlvbi5hZGRlZE5vZGVzO1xyXG4gICAgICAgIH0gZWxzZSBpZiAobXV0YXRpb24ucmVtb3ZlZE5vZGVzLmxlbmd0aCA9PT0gMCAmJiBtdXRhdGlvbi50YXJnZXQgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgbm9kZXMgPSBbbXV0YXRpb24udGFyZ2V0XTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKG5vZGVzLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZvciAobGV0IG5vZGVzX192YWx1ZSBvZiBub2Rlcykge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5pc0V4Y2x1ZGVkKG5vZGVzX192YWx1ZSkpIHtcclxuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChub2Rlc19fdmFsdWUubm9kZVR5cGUgIT0gMSAmJiBub2Rlc19fdmFsdWUubm9kZVR5cGUgIT0gMykge1xyXG4gICAgICAgICAgICAgICAgY29udGludWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKG5vZGVzX192YWx1ZS5ub2RlVHlwZSA9PSAzKSB7XHJcbiAgICAgICAgICAgICAgICBub2Rlc19fdmFsdWUgPSBub2Rlc19fdmFsdWUucGFyZW50Tm9kZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAobm9kZXNfX3ZhbHVlLnRhZ05hbWUgPT09ICdCT0RZJykge1xyXG4gICAgICAgICAgICAgICAgY29udGludWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgbGV0IGh0bWwgPSAnJztcclxuICAgICAgICAgICAgLy8gdGhpcyBpcyBpbXBvcnRhbnQ6IHByZXZpb3VzbHkgc2V0IGF0dHJpYnV0ZXMgbXVzdCBiZSByZW1vdmVkIChiZWNhdXNlIHRoZXkgY291bGQgaGF2ZSBjaGFuZ2VkIGluIHRoZSBtZWFudGltZSBhZ2FpbilcclxuICAgICAgICAgICAgbm9kZXNfX3ZhbHVlLnJlbW92ZUF0dHJpYnV0ZSgnZGF0YS1ndGJhYmVsLWhpZGUnKTtcclxuICAgICAgICAgICAgaHRtbCA9IG5vZGVzX192YWx1ZS5vdXRlckhUTUw7XHJcbiAgICAgICAgICAgIG5vZGVzX192YWx1ZS5zZXRBdHRyaWJ1dGUoJ2RhdGEtZ3RiYWJlbC1oaWRlJywgJycpO1xyXG4gICAgICAgICAgICBsZXQgcmVzcCA9IGF3YWl0IHRoaXMuZ2V0VHJhbnNsYXRpb24oaHRtbCk7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlc3ApO1xyXG4gICAgICAgICAgICBsZXQgdHJhbnMgPSByZXNwLnN1Y2Nlc3MgPT09IHRydWUgPyByZXNwLmRhdGEgOiBodG1sO1xyXG4gICAgICAgICAgICB0aGlzLnNldEh0bWxBbmRLZWVwRXZlbnRMaXN0ZW5lcnMobm9kZXNfX3ZhbHVlLCB0cmFucyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHNldEh0bWxBbmRLZWVwRXZlbnRMaXN0ZW5lcnMobm9kZSwgaHRtbCkge1xyXG4gICAgICAgIHRoaXMuZXhjbHVkZS5wdXNoKG5vZGUpO1xyXG4gICAgICAgIGxldCBkaWZmID0gdGhpcy5kZC5kaWZmKG5vZGUsIGh0bWwpO1xyXG4gICAgICAgIHRoaXMuZGQuYXBwbHkobm9kZSwgZGlmZik7XHJcbiAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKCgpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5leGNsdWRlID0gdGhpcy5leGNsdWRlLmZpbHRlcihleGNsdWRlX192YWx1ZSA9PiBleGNsdWRlX192YWx1ZSAhPT0gbm9kZSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0VHJhbnNsYXRpb24oaHRtbCkge1xyXG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHtcclxuICAgICAgICAgICAgbGV0IGRhdGEgPSBuZXcgVVJMU2VhcmNoUGFyYW1zKCk7XHJcbiAgICAgICAgICAgIGRhdGEuYXBwZW5kKCdodG1sJywgaHRtbCk7XHJcbiAgICAgICAgICAgIGxldCB1cmwgPSB3aW5kb3cubG9jYXRpb24ucHJvdG9jb2wgKyAnLy8nICsgd2luZG93LmxvY2F0aW9uLmhvc3QgKyB3aW5kb3cubG9jYXRpb24ucGF0aG5hbWU7XHJcbiAgICAgICAgICAgIHVybCArPSAodXJsLmluZGV4T2YoJz8nKSA+IC0xID8gJyYnIDogJz8nKSArICdndGJhYmVsX3RyYW5zbGF0ZV9wYXJ0PTEnO1xyXG4gICAgICAgICAgICBmZXRjaCh1cmwsIHtcclxuICAgICAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxyXG4gICAgICAgICAgICAgICAgYm9keTogZGF0YSxcclxuICAgICAgICAgICAgICAgIGNhY2hlOiAnbm8tY2FjaGUnXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAudGhlbihyZXN1bHQgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQuanNvbigpO1xyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgIC5jYXRjaChlcnJvciA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IGVycm9yIH07XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgLnRoZW4ocmVzdWx0ID0+IHtcclxuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3VsdCk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBpc0V4Y2x1ZGVkKG5vZGUpIHtcclxuICAgICAgICBmb3IgKGxldCBleGNsdWRlX192YWx1ZSBvZiB0aGlzLmV4Y2x1ZGUpIHtcclxuICAgICAgICAgICAgaWYgKGV4Y2x1ZGVfX3ZhbHVlLmNvbnRhaW5zKG5vZGUpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbn1cclxuIiwiaW1wb3J0IERldGVjdENoYW5nZXMgZnJvbSAnLi9EZXRlY3RDaGFuZ2VzJztcclxuXHJcbmNvbnN0IGQgPSBuZXcgRGV0ZWN0Q2hhbmdlcygpO1xyXG5kb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdET01Db250ZW50TG9hZGVkJywgKCkgPT4ge1xyXG4gICAgZC5pbml0KCk7XHJcbn0pO1xyXG4iLCJmdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikge1xuICByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDoge1xuICAgIFwiZGVmYXVsdFwiOiBvYmpcbiAgfTtcbn1cblxubW9kdWxlLmV4cG9ydHMgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0OyIsIlwidXNlIHN0cmljdFwiO2Z1bmN0aW9uIG9ialRvTm9kZShlLHQsbyl7dmFyIG47cmV0dXJuXCIjdGV4dFwiPT09ZS5ub2RlTmFtZT9uPW8uZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoZS5kYXRhKTpcIiNjb21tZW50XCI9PT1lLm5vZGVOYW1lP249by5kb2N1bWVudC5jcmVhdGVDb21tZW50KGUuZGF0YSk6KFwic3ZnXCI9PT1lLm5vZGVOYW1lfHx0PyhuPW8uZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKFwiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmdcIixlLm5vZGVOYW1lKSx0PSEwKTpuPW8uZG9jdW1lbnQuY3JlYXRlRWxlbWVudChlLm5vZGVOYW1lKSxlLmF0dHJpYnV0ZXMmJk9iamVjdC5lbnRyaWVzKGUuYXR0cmlidXRlcykuZm9yRWFjaChmdW5jdGlvbihlKXt2YXIgdD1lWzBdLG89ZVsxXTtyZXR1cm4gbi5zZXRBdHRyaWJ1dGUodCxvKX0pLGUuY2hpbGROb2RlcyYmZS5jaGlsZE5vZGVzLmZvckVhY2goZnVuY3Rpb24oZSl7cmV0dXJuIG4uYXBwZW5kQ2hpbGQob2JqVG9Ob2RlKGUsdCxvKSl9KSxvLnZhbHVlRGlmZmluZyYmKGUudmFsdWUmJihuLnZhbHVlPWUudmFsdWUpLGUuY2hlY2tlZCYmKG4uY2hlY2tlZD1lLmNoZWNrZWQpLGUuc2VsZWN0ZWQmJihuLnNlbGVjdGVkPWUuc2VsZWN0ZWQpKSksbn1mdW5jdGlvbiBnZXRGcm9tUm91dGUoZSx0KXtmb3IodD10LnNsaWNlKCk7dC5sZW5ndGg+MDspe2lmKCFlLmNoaWxkTm9kZXMpcmV0dXJuITE7dmFyIG89dC5zcGxpY2UoMCwxKVswXTtlPWUuY2hpbGROb2Rlc1tvXX1yZXR1cm4gZX1mdW5jdGlvbiBhcHBseURpZmYoZSx0LG8pe3ZhciBuLHMsaSxhLGw9Z2V0RnJvbVJvdXRlKGUsdFtvLl9jb25zdC5yb3V0ZV0pLHI9e2RpZmY6dCxub2RlOmx9O2lmKG8ucHJlRGlmZkFwcGx5KHIpKXJldHVybiEwO3N3aXRjaCh0W28uX2NvbnN0LmFjdGlvbl0pe2Nhc2Ugby5fY29uc3QuYWRkQXR0cmlidXRlOmlmKCFsfHwhbC5zZXRBdHRyaWJ1dGUpcmV0dXJuITE7bC5zZXRBdHRyaWJ1dGUodFtvLl9jb25zdC5uYW1lXSx0W28uX2NvbnN0LnZhbHVlXSk7YnJlYWs7Y2FzZSBvLl9jb25zdC5tb2RpZnlBdHRyaWJ1dGU6aWYoIWx8fCFsLnNldEF0dHJpYnV0ZSlyZXR1cm4hMTtsLnNldEF0dHJpYnV0ZSh0W28uX2NvbnN0Lm5hbWVdLHRbby5fY29uc3QubmV3VmFsdWVdKSxcIklOUFVUXCI9PT1sLm5vZGVOYW1lJiZcInZhbHVlXCI9PT10W28uX2NvbnN0Lm5hbWVdJiYobC52YWx1ZT10W28uX2NvbnN0Lm5ld1ZhbHVlXSk7YnJlYWs7Y2FzZSBvLl9jb25zdC5yZW1vdmVBdHRyaWJ1dGU6aWYoIWx8fCFsLnJlbW92ZUF0dHJpYnV0ZSlyZXR1cm4hMTtsLnJlbW92ZUF0dHJpYnV0ZSh0W28uX2NvbnN0Lm5hbWVdKTticmVhaztjYXNlIG8uX2NvbnN0Lm1vZGlmeVRleHRFbGVtZW50OmlmKCFsfHwzIT09bC5ub2RlVHlwZSlyZXR1cm4hMTtvLnRleHREaWZmKGwsbC5kYXRhLHRbby5fY29uc3Qub2xkVmFsdWVdLHRbby5fY29uc3QubmV3VmFsdWVdKTticmVhaztjYXNlIG8uX2NvbnN0Lm1vZGlmeVZhbHVlOmlmKCFsfHx2b2lkIDA9PT1sLnZhbHVlKXJldHVybiExO2wudmFsdWU9dFtvLl9jb25zdC5uZXdWYWx1ZV07YnJlYWs7Y2FzZSBvLl9jb25zdC5tb2RpZnlDb21tZW50OmlmKCFsfHx2b2lkIDA9PT1sLmRhdGEpcmV0dXJuITE7by50ZXh0RGlmZihsLGwuZGF0YSx0W28uX2NvbnN0Lm9sZFZhbHVlXSx0W28uX2NvbnN0Lm5ld1ZhbHVlXSk7YnJlYWs7Y2FzZSBvLl9jb25zdC5tb2RpZnlDaGVja2VkOmlmKCFsfHx2b2lkIDA9PT1sLmNoZWNrZWQpcmV0dXJuITE7bC5jaGVja2VkPXRbby5fY29uc3QubmV3VmFsdWVdO2JyZWFrO2Nhc2Ugby5fY29uc3QubW9kaWZ5U2VsZWN0ZWQ6aWYoIWx8fHZvaWQgMD09PWwuc2VsZWN0ZWQpcmV0dXJuITE7bC5zZWxlY3RlZD10W28uX2NvbnN0Lm5ld1ZhbHVlXTticmVhaztjYXNlIG8uX2NvbnN0LnJlcGxhY2VFbGVtZW50OmwucGFyZW50Tm9kZS5yZXBsYWNlQ2hpbGQob2JqVG9Ob2RlKHRbby5fY29uc3QubmV3VmFsdWVdLFwiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmdcIj09PWwubmFtZXNwYWNlVVJJLG8pLGwpO2JyZWFrO2Nhc2Ugby5fY29uc3QucmVsb2NhdGVHcm91cDpBcnJheS5hcHBseSh2b2lkIDAsbmV3IEFycmF5KHQuZ3JvdXBMZW5ndGgpKS5tYXAoZnVuY3Rpb24oKXtyZXR1cm4gbC5yZW1vdmVDaGlsZChsLmNoaWxkTm9kZXNbdFtvLl9jb25zdC5mcm9tXV0pfSkuZm9yRWFjaChmdW5jdGlvbihlLG4pezA9PT1uJiYocz1sLmNoaWxkTm9kZXNbdFtvLl9jb25zdC50b11dKSxsLmluc2VydEJlZm9yZShlLHN8fG51bGwpfSk7YnJlYWs7Y2FzZSBvLl9jb25zdC5yZW1vdmVFbGVtZW50OmwucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChsKTticmVhaztjYXNlIG8uX2NvbnN0LmFkZEVsZW1lbnQ6YT0oaT10W28uX2NvbnN0LnJvdXRlXS5zbGljZSgpKS5zcGxpY2UoaS5sZW5ndGgtMSwxKVswXSwobD1nZXRGcm9tUm91dGUoZSxpKSkuaW5zZXJ0QmVmb3JlKG9ialRvTm9kZSh0W28uX2NvbnN0LmVsZW1lbnRdLFwiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmdcIj09PWwubmFtZXNwYWNlVVJJLG8pLGwuY2hpbGROb2Rlc1thXXx8bnVsbCk7YnJlYWs7Y2FzZSBvLl9jb25zdC5yZW1vdmVUZXh0RWxlbWVudDppZighbHx8MyE9PWwubm9kZVR5cGUpcmV0dXJuITE7bC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGwpO2JyZWFrO2Nhc2Ugby5fY29uc3QuYWRkVGV4dEVsZW1lbnQ6aWYoYT0oaT10W28uX2NvbnN0LnJvdXRlXS5zbGljZSgpKS5zcGxpY2UoaS5sZW5ndGgtMSwxKVswXSxuPW8uZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUodFtvLl9jb25zdC52YWx1ZV0pLCEobD1nZXRGcm9tUm91dGUoZSxpKSl8fCFsLmNoaWxkTm9kZXMpcmV0dXJuITE7bC5pbnNlcnRCZWZvcmUobixsLmNoaWxkTm9kZXNbYV18fG51bGwpO2JyZWFrO2RlZmF1bHQ6Y29uc29sZS5sb2coXCJ1bmtub3duIGFjdGlvblwiKX1yZXR1cm4gci5uZXdOb2RlPW4sby5wb3N0RGlmZkFwcGx5KHIpLCEwfWZ1bmN0aW9uIGFwcGx5RE9NKGUsdCxvKXtyZXR1cm4gdC5ldmVyeShmdW5jdGlvbih0KXtyZXR1cm4gYXBwbHlEaWZmKGUsdCxvKX0pfWZ1bmN0aW9uIHN3YXAoZSx0LG8pe3ZhciBuPWVbdF07ZVt0XT1lW29dLGVbb109bn1mdW5jdGlvbiB1bmRvRGlmZihlLHQsbyl7c3dpdGNoKHRbby5fY29uc3QuYWN0aW9uXSl7Y2FzZSBvLl9jb25zdC5hZGRBdHRyaWJ1dGU6dFtvLl9jb25zdC5hY3Rpb25dPW8uX2NvbnN0LnJlbW92ZUF0dHJpYnV0ZSxhcHBseURpZmYoZSx0LG8pO2JyZWFrO2Nhc2Ugby5fY29uc3QubW9kaWZ5QXR0cmlidXRlOnN3YXAodCxvLl9jb25zdC5vbGRWYWx1ZSxvLl9jb25zdC5uZXdWYWx1ZSksYXBwbHlEaWZmKGUsdCxvKTticmVhaztjYXNlIG8uX2NvbnN0LnJlbW92ZUF0dHJpYnV0ZTp0W28uX2NvbnN0LmFjdGlvbl09by5fY29uc3QuYWRkQXR0cmlidXRlLGFwcGx5RGlmZihlLHQsbyk7YnJlYWs7Y2FzZSBvLl9jb25zdC5tb2RpZnlUZXh0RWxlbWVudDpjYXNlIG8uX2NvbnN0Lm1vZGlmeVZhbHVlOmNhc2Ugby5fY29uc3QubW9kaWZ5Q29tbWVudDpjYXNlIG8uX2NvbnN0Lm1vZGlmeUNoZWNrZWQ6Y2FzZSBvLl9jb25zdC5tb2RpZnlTZWxlY3RlZDpjYXNlIG8uX2NvbnN0LnJlcGxhY2VFbGVtZW50OnN3YXAodCxvLl9jb25zdC5vbGRWYWx1ZSxvLl9jb25zdC5uZXdWYWx1ZSksYXBwbHlEaWZmKGUsdCxvKTticmVhaztjYXNlIG8uX2NvbnN0LnJlbG9jYXRlR3JvdXA6c3dhcCh0LG8uX2NvbnN0LmZyb20sby5fY29uc3QudG8pLGFwcGx5RGlmZihlLHQsbyk7YnJlYWs7Y2FzZSBvLl9jb25zdC5yZW1vdmVFbGVtZW50OnRbby5fY29uc3QuYWN0aW9uXT1vLl9jb25zdC5hZGRFbGVtZW50LGFwcGx5RGlmZihlLHQsbyk7YnJlYWs7Y2FzZSBvLl9jb25zdC5hZGRFbGVtZW50OnRbby5fY29uc3QuYWN0aW9uXT1vLl9jb25zdC5yZW1vdmVFbGVtZW50LGFwcGx5RGlmZihlLHQsbyk7YnJlYWs7Y2FzZSBvLl9jb25zdC5yZW1vdmVUZXh0RWxlbWVudDp0W28uX2NvbnN0LmFjdGlvbl09by5fY29uc3QuYWRkVGV4dEVsZW1lbnQsYXBwbHlEaWZmKGUsdCxvKTticmVhaztjYXNlIG8uX2NvbnN0LmFkZFRleHRFbGVtZW50OnRbby5fY29uc3QuYWN0aW9uXT1vLl9jb25zdC5yZW1vdmVUZXh0RWxlbWVudCxhcHBseURpZmYoZSx0LG8pO2JyZWFrO2RlZmF1bHQ6Y29uc29sZS5sb2coXCJ1bmtub3duIGFjdGlvblwiKX19ZnVuY3Rpb24gdW5kb0RPTShlLHQsbyl7dC5sZW5ndGh8fCh0PVt0XSksKHQ9dC5zbGljZSgpKS5yZXZlcnNlKCksdC5mb3JFYWNoKGZ1bmN0aW9uKHQpe3VuZG9EaWZmKGUsdCxvKX0pfU9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLFwiX19lc01vZHVsZVwiLHt2YWx1ZTohMH0pO3ZhciBEaWZmPWZ1bmN0aW9uKGUpe3ZhciB0PXRoaXM7dm9pZCAwPT09ZSYmKGU9e30pLE9iamVjdC5lbnRyaWVzKGUpLmZvckVhY2goZnVuY3Rpb24oZSl7dmFyIG89ZVswXSxuPWVbMV07cmV0dXJuIHRbb109bn0pfTtmdW5jdGlvbiBlbGVtZW50RGVzY3JpcHRvcnMoZSl7dmFyIHQ9W107cmV0dXJuXCIjdGV4dFwiIT09ZS5ub2RlTmFtZSYmXCIjY29tbWVudFwiIT09ZS5ub2RlTmFtZSYmKHQucHVzaChlLm5vZGVOYW1lKSxlLmF0dHJpYnV0ZXMmJihlLmF0dHJpYnV0ZXMuY2xhc3MmJnQucHVzaChlLm5vZGVOYW1lK1wiLlwiK2UuYXR0cmlidXRlcy5jbGFzcy5yZXBsYWNlKC8gL2csXCIuXCIpKSxlLmF0dHJpYnV0ZXMuaWQmJnQucHVzaChlLm5vZGVOYW1lK1wiI1wiK2UuYXR0cmlidXRlcy5pZCkpKSx0fWZ1bmN0aW9uIGZpbmRVbmlxdWVEZXNjcmlwdG9ycyhlKXt2YXIgdD17fSxvPXt9O3JldHVybiBlLmZvckVhY2goZnVuY3Rpb24oZSl7ZWxlbWVudERlc2NyaXB0b3JzKGUpLmZvckVhY2goZnVuY3Rpb24oZSl7dmFyIG49ZSBpbiB0O258fGUgaW4gbz9uJiYoZGVsZXRlIHRbZV0sb1tlXT0hMCk6dFtlXT0hMH0pfSksdH1mdW5jdGlvbiB1bmlxdWVJbkJvdGgoZSx0KXt2YXIgbz1maW5kVW5pcXVlRGVzY3JpcHRvcnMoZSksbj1maW5kVW5pcXVlRGVzY3JpcHRvcnModCkscz17fTtyZXR1cm4gT2JqZWN0LmtleXMobykuZm9yRWFjaChmdW5jdGlvbihlKXtuW2VdJiYoc1tlXT0hMCl9KSxzfWZ1bmN0aW9uIHJlbW92ZURvbmUoZSl7cmV0dXJuIGRlbGV0ZSBlLm91dGVyRG9uZSxkZWxldGUgZS5pbm5lckRvbmUsZGVsZXRlIGUudmFsdWVEb25lLCFlLmNoaWxkTm9kZXN8fGUuY2hpbGROb2Rlcy5ldmVyeShyZW1vdmVEb25lKX1mdW5jdGlvbiBpc0VxdWFsKGUsdCl7aWYoIVtcIm5vZGVOYW1lXCIsXCJ2YWx1ZVwiLFwiY2hlY2tlZFwiLFwic2VsZWN0ZWRcIixcImRhdGFcIl0uZXZlcnkoZnVuY3Rpb24obyl7cmV0dXJuIGVbb109PT10W29dfSkpcmV0dXJuITE7aWYoQm9vbGVhbihlLmF0dHJpYnV0ZXMpIT09Qm9vbGVhbih0LmF0dHJpYnV0ZXMpKXJldHVybiExO2lmKEJvb2xlYW4oZS5jaGlsZE5vZGVzKSE9PUJvb2xlYW4odC5jaGlsZE5vZGVzKSlyZXR1cm4hMTtpZihlLmF0dHJpYnV0ZXMpe3ZhciBvPU9iamVjdC5rZXlzKGUuYXR0cmlidXRlcyksbj1PYmplY3Qua2V5cyh0LmF0dHJpYnV0ZXMpO2lmKG8ubGVuZ3RoIT09bi5sZW5ndGgpcmV0dXJuITE7aWYoIW8uZXZlcnkoZnVuY3Rpb24obyl7cmV0dXJuIGUuYXR0cmlidXRlc1tvXT09PXQuYXR0cmlidXRlc1tvXX0pKXJldHVybiExfWlmKGUuY2hpbGROb2Rlcyl7aWYoZS5jaGlsZE5vZGVzLmxlbmd0aCE9PXQuY2hpbGROb2Rlcy5sZW5ndGgpcmV0dXJuITE7aWYoIWUuY2hpbGROb2Rlcy5ldmVyeShmdW5jdGlvbihlLG8pe3JldHVybiBpc0VxdWFsKGUsdC5jaGlsZE5vZGVzW29dKX0pKXJldHVybiExfXJldHVybiEwfWZ1bmN0aW9uIHJvdWdobHlFcXVhbChlLHQsbyxuLHMpe2lmKCFlfHwhdClyZXR1cm4hMTtpZihlLm5vZGVOYW1lIT09dC5ub2RlTmFtZSlyZXR1cm4hMTtpZihcIiN0ZXh0XCI9PT1lLm5vZGVOYW1lKXJldHVybiEhc3x8ZS5kYXRhPT09dC5kYXRhO2lmKGUubm9kZU5hbWUgaW4gbylyZXR1cm4hMDtpZihlLmF0dHJpYnV0ZXMmJnQuYXR0cmlidXRlcyl7aWYoZS5hdHRyaWJ1dGVzLmlkKXtpZihlLmF0dHJpYnV0ZXMuaWQhPT10LmF0dHJpYnV0ZXMuaWQpcmV0dXJuITE7aWYoZS5ub2RlTmFtZStcIiNcIitlLmF0dHJpYnV0ZXMuaWQgaW4gbylyZXR1cm4hMH1pZihlLmF0dHJpYnV0ZXMuY2xhc3MmJmUuYXR0cmlidXRlcy5jbGFzcz09PXQuYXR0cmlidXRlcy5jbGFzcylpZihlLm5vZGVOYW1lK1wiLlwiK2UuYXR0cmlidXRlcy5jbGFzcy5yZXBsYWNlKC8gL2csXCIuXCIpaW4gbylyZXR1cm4hMH1pZihuKXJldHVybiEwO3ZhciBpPWUuY2hpbGROb2Rlcz9lLmNoaWxkTm9kZXMuc2xpY2UoKS5yZXZlcnNlKCk6W10sYT10LmNoaWxkTm9kZXM/dC5jaGlsZE5vZGVzLnNsaWNlKCkucmV2ZXJzZSgpOltdO2lmKGkubGVuZ3RoIT09YS5sZW5ndGgpcmV0dXJuITE7aWYocylyZXR1cm4gaS5ldmVyeShmdW5jdGlvbihlLHQpe3JldHVybiBlLm5vZGVOYW1lPT09YVt0XS5ub2RlTmFtZX0pO3ZhciBsPXVuaXF1ZUluQm90aChpLGEpO3JldHVybiBpLmV2ZXJ5KGZ1bmN0aW9uKGUsdCl7cmV0dXJuIHJvdWdobHlFcXVhbChlLGFbdF0sbCwhMCwhMCl9KX1mdW5jdGlvbiBjbG9uZU9iaihlKXtyZXR1cm4gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShlKSl9ZnVuY3Rpb24gZmluZENvbW1vblN1YnNldHMoZSx0LG8sbil7dmFyIHM9MCxpPVtdLGE9ZS5sZW5ndGgsbD10Lmxlbmd0aCxyPUFycmF5LmFwcGx5KHZvaWQgMCxuZXcgQXJyYXkoYSsxKSkubWFwKGZ1bmN0aW9uKCl7cmV0dXJuW119KSxjPXVuaXF1ZUluQm90aChlLHQpLHU9YT09PWw7dSYmZS5zb21lKGZ1bmN0aW9uKGUsbyl7dmFyIG49ZWxlbWVudERlc2NyaXB0b3JzKGUpLHM9ZWxlbWVudERlc2NyaXB0b3JzKHRbb10pO3JldHVybiBuLmxlbmd0aCE9PXMubGVuZ3RoPyh1PSExLCEwKToobi5zb21lKGZ1bmN0aW9uKGUsdCl7aWYoZSE9PXNbdF0pcmV0dXJuIHU9ITEsITB9KSwhdXx8dm9pZCAwKX0pO2Zvcih2YXIgZD0wO2Q8YTtkKyspZm9yKHZhciBmPWVbZF0saD0wO2g8bDtoKyspe3ZhciBwPXRbaF07b1tkXXx8bltoXXx8IXJvdWdobHlFcXVhbChmLHAsYyx1KT9yW2QrMV1baCsxXT0wOihyW2QrMV1baCsxXT1yW2RdW2hdP3JbZF1baF0rMToxLHJbZCsxXVtoKzFdPj1zJiYocz1yW2QrMV1baCsxXSxpPVtkKzEsaCsxXSkpfXJldHVybiAwIT09cyYme29sZFZhbHVlOmlbMF0tcyxuZXdWYWx1ZTppWzFdLXMsbGVuZ3RoOnN9fWZ1bmN0aW9uIG1ha2VBcnJheShlLHQpe3JldHVybiBBcnJheS5hcHBseSh2b2lkIDAsbmV3IEFycmF5KGUpKS5tYXAoZnVuY3Rpb24oKXtyZXR1cm4gdH0pfWZ1bmN0aW9uIGdldEdhcEluZm9ybWF0aW9uKGUsdCxvKXt2YXIgbj1lLmNoaWxkTm9kZXM/bWFrZUFycmF5KGUuY2hpbGROb2Rlcy5sZW5ndGgsITApOltdLHM9dC5jaGlsZE5vZGVzP21ha2VBcnJheSh0LmNoaWxkTm9kZXMubGVuZ3RoLCEwKTpbXSxpPTA7cmV0dXJuIG8uZm9yRWFjaChmdW5jdGlvbihlKXtmb3IodmFyIHQ9ZS5vbGRWYWx1ZStlLmxlbmd0aCxvPWUubmV3VmFsdWUrZS5sZW5ndGgsYT1lLm9sZFZhbHVlO2E8dDthKz0xKW5bYV09aTtmb3IodmFyIGw9ZS5uZXdWYWx1ZTtsPG87bCs9MSlzW2xdPWk7aSs9MX0pLHtnYXBzMTpuLGdhcHMyOnN9fWZ1bmN0aW9uIG1hcmtTdWJUcmVlcyhlLHQpe2Zvcih2YXIgbz1lLmNoaWxkTm9kZXM/ZS5jaGlsZE5vZGVzOltdLG49dC5jaGlsZE5vZGVzP3QuY2hpbGROb2RlczpbXSxzPW1ha2VBcnJheShvLmxlbmd0aCwhMSksaT1tYWtlQXJyYXkobi5sZW5ndGgsITEpLGE9W10sbD0hMCxyPWZ1bmN0aW9uKCl7cmV0dXJuIGFyZ3VtZW50c1sxXX07bDspe2lmKGw9ZmluZENvbW1vblN1YnNldHMobyxuLHMsaSkpYS5wdXNoKGwpLEFycmF5LmFwcGx5KHZvaWQgMCxuZXcgQXJyYXkobC5sZW5ndGgpKS5tYXAocikuZm9yRWFjaChmdW5jdGlvbihlKXtyZXR1cm4gdD1lLHNbbC5vbGRWYWx1ZSt0XT0hMCx2b2lkKGlbbC5uZXdWYWx1ZSt0XT0hMCk7dmFyIHR9KX1yZXR1cm4gZS5zdWJzZXRzPWEsZS5zdWJzZXRzQWdlPTEwMCxhfURpZmYucHJvdG90eXBlLnRvU3RyaW5nPWZ1bmN0aW9uKCl7cmV0dXJuIEpTT04uc3RyaW5naWZ5KHRoaXMpfSxEaWZmLnByb3RvdHlwZS5zZXRWYWx1ZT1mdW5jdGlvbihlLHQpe3JldHVybiB0aGlzW2VdPXQsdGhpc307dmFyIERpZmZUcmFja2VyPWZ1bmN0aW9uKCl7dGhpcy5saXN0PVtdfTtmdW5jdGlvbiBnZXRGcm9tVmlydHVhbFJvdXRlKGUsdCl7dmFyIG8sbixzPWU7Zm9yKHQ9dC5zbGljZSgpO3QubGVuZ3RoPjA7KXtpZighcy5jaGlsZE5vZGVzKXJldHVybiExO249dC5zcGxpY2UoMCwxKVswXSxvPXMscz1zLmNoaWxkTm9kZXNbbl19cmV0dXJue25vZGU6cyxwYXJlbnROb2RlOm8sbm9kZUluZGV4Om59fWZ1bmN0aW9uIGFwcGx5VmlydHVhbERpZmYoZSx0LG8pe3ZhciBuLHMsaSxhPWdldEZyb21WaXJ0dWFsUm91dGUoZSx0W28uX2NvbnN0LnJvdXRlXSksbD1hLm5vZGUscj1hLnBhcmVudE5vZGUsYz1hLm5vZGVJbmRleCx1PVtdLGQ9e2RpZmY6dCxub2RlOmx9O2lmKG8ucHJlRGlmZkFwcGx5KGQpKXJldHVybiEwO3N3aXRjaCh0W28uX2NvbnN0LmFjdGlvbl0pe2Nhc2Ugby5fY29uc3QuYWRkQXR0cmlidXRlOmwuYXR0cmlidXRlc3x8KGwuYXR0cmlidXRlcz17fSksbC5hdHRyaWJ1dGVzW3Rbby5fY29uc3QubmFtZV1dPXRbby5fY29uc3QudmFsdWVdLFwiY2hlY2tlZFwiPT09dFtvLl9jb25zdC5uYW1lXT9sLmNoZWNrZWQ9ITA6XCJzZWxlY3RlZFwiPT09dFtvLl9jb25zdC5uYW1lXT9sLnNlbGVjdGVkPSEwOlwiSU5QVVRcIj09PWwubm9kZU5hbWUmJlwidmFsdWVcIj09PXRbby5fY29uc3QubmFtZV0mJihsLnZhbHVlPXRbby5fY29uc3QudmFsdWVdKTticmVhaztjYXNlIG8uX2NvbnN0Lm1vZGlmeUF0dHJpYnV0ZTpsLmF0dHJpYnV0ZXNbdFtvLl9jb25zdC5uYW1lXV09dFtvLl9jb25zdC5uZXdWYWx1ZV07YnJlYWs7Y2FzZSBvLl9jb25zdC5yZW1vdmVBdHRyaWJ1dGU6ZGVsZXRlIGwuYXR0cmlidXRlc1t0W28uX2NvbnN0Lm5hbWVdXSwwPT09T2JqZWN0LmtleXMobC5hdHRyaWJ1dGVzKS5sZW5ndGgmJmRlbGV0ZSBsLmF0dHJpYnV0ZXMsXCJjaGVja2VkXCI9PT10W28uX2NvbnN0Lm5hbWVdP2wuY2hlY2tlZD0hMTpcInNlbGVjdGVkXCI9PT10W28uX2NvbnN0Lm5hbWVdP2RlbGV0ZSBsLnNlbGVjdGVkOlwiSU5QVVRcIj09PWwubm9kZU5hbWUmJlwidmFsdWVcIj09PXRbby5fY29uc3QubmFtZV0mJmRlbGV0ZSBsLnZhbHVlO2JyZWFrO2Nhc2Ugby5fY29uc3QubW9kaWZ5VGV4dEVsZW1lbnQ6bC5kYXRhPXRbby5fY29uc3QubmV3VmFsdWVdO2JyZWFrO2Nhc2Ugby5fY29uc3QubW9kaWZ5VmFsdWU6bC52YWx1ZT10W28uX2NvbnN0Lm5ld1ZhbHVlXTticmVhaztjYXNlIG8uX2NvbnN0Lm1vZGlmeUNvbW1lbnQ6bC5kYXRhPXRbby5fY29uc3QubmV3VmFsdWVdO2JyZWFrO2Nhc2Ugby5fY29uc3QubW9kaWZ5Q2hlY2tlZDpsLmNoZWNrZWQ9dFtvLl9jb25zdC5uZXdWYWx1ZV07YnJlYWs7Y2FzZSBvLl9jb25zdC5tb2RpZnlTZWxlY3RlZDpsLnNlbGVjdGVkPXRbby5fY29uc3QubmV3VmFsdWVdO2JyZWFrO2Nhc2Ugby5fY29uc3QucmVwbGFjZUVsZW1lbnQ6KG49Y2xvbmVPYmoodFtvLl9jb25zdC5uZXdWYWx1ZV0pKS5vdXRlckRvbmU9ITAsbi5pbm5lckRvbmU9ITAsbi52YWx1ZURvbmU9ITAsci5jaGlsZE5vZGVzW2NdPW47YnJlYWs7Y2FzZSBvLl9jb25zdC5yZWxvY2F0ZUdyb3VwOmwuY2hpbGROb2Rlcy5zcGxpY2UodFtvLl9jb25zdC5mcm9tXSx0Lmdyb3VwTGVuZ3RoKS5yZXZlcnNlKCkuZm9yRWFjaChmdW5jdGlvbihlKXtyZXR1cm4gbC5jaGlsZE5vZGVzLnNwbGljZSh0W28uX2NvbnN0LnRvXSwwLGUpfSksbC5zdWJzZXRzJiZsLnN1YnNldHMuZm9yRWFjaChmdW5jdGlvbihlKXtpZih0W28uX2NvbnN0LmZyb21dPHRbby5fY29uc3QudG9dJiZlLm9sZFZhbHVlPD10W28uX2NvbnN0LnRvXSYmZS5vbGRWYWx1ZT50W28uX2NvbnN0LmZyb21dKXtlLm9sZFZhbHVlLT10Lmdyb3VwTGVuZ3RoO3ZhciBuPWUub2xkVmFsdWUrZS5sZW5ndGgtdFtvLl9jb25zdC50b107bj4wJiYodS5wdXNoKHtvbGRWYWx1ZTp0W28uX2NvbnN0LnRvXSt0Lmdyb3VwTGVuZ3RoLG5ld1ZhbHVlOmUubmV3VmFsdWUrZS5sZW5ndGgtbixsZW5ndGg6bn0pLGUubGVuZ3RoLT1uKX1lbHNlIGlmKHRbby5fY29uc3QuZnJvbV0+dFtvLl9jb25zdC50b10mJmUub2xkVmFsdWU+dFtvLl9jb25zdC50b10mJmUub2xkVmFsdWU8dFtvLl9jb25zdC5mcm9tXSl7ZS5vbGRWYWx1ZSs9dC5ncm91cExlbmd0aDt2YXIgcz1lLm9sZFZhbHVlK2UubGVuZ3RoLXRbby5fY29uc3QudG9dO3M+MCYmKHUucHVzaCh7b2xkVmFsdWU6dFtvLl9jb25zdC50b10rdC5ncm91cExlbmd0aCxuZXdWYWx1ZTplLm5ld1ZhbHVlK2UubGVuZ3RoLXMsbGVuZ3RoOnN9KSxlLmxlbmd0aC09cyl9ZWxzZSBlLm9sZFZhbHVlPT09dFtvLl9jb25zdC5mcm9tXSYmKGUub2xkVmFsdWU9dFtvLl9jb25zdC50b10pfSk7YnJlYWs7Y2FzZSBvLl9jb25zdC5yZW1vdmVFbGVtZW50OnIuY2hpbGROb2Rlcy5zcGxpY2UoYywxKSxyLnN1YnNldHMmJnIuc3Vic2V0cy5mb3JFYWNoKGZ1bmN0aW9uKGUpe2Uub2xkVmFsdWU+Yz9lLm9sZFZhbHVlLT0xOmUub2xkVmFsdWU9PT1jP2UuZGVsZXRlPSEwOmUub2xkVmFsdWU8YyYmZS5vbGRWYWx1ZStlLmxlbmd0aD5jJiYoZS5vbGRWYWx1ZStlLmxlbmd0aC0xPT09Yz9lLmxlbmd0aC0tOih1LnB1c2goe25ld1ZhbHVlOmUubmV3VmFsdWUrYy1lLm9sZFZhbHVlLG9sZFZhbHVlOmMsbGVuZ3RoOmUubGVuZ3RoLWMrZS5vbGRWYWx1ZS0xfSksZS5sZW5ndGg9Yy1lLm9sZFZhbHVlKSl9KSxsPXI7YnJlYWs7Y2FzZSBvLl9jb25zdC5hZGRFbGVtZW50OnM9dFtvLl9jb25zdC5yb3V0ZV0uc2xpY2UoKSxpPXMuc3BsaWNlKHMubGVuZ3RoLTEsMSlbMF0sbD1nZXRGcm9tVmlydHVhbFJvdXRlKGUscykubm9kZSwobj1jbG9uZU9iaih0W28uX2NvbnN0LmVsZW1lbnRdKSkub3V0ZXJEb25lPSEwLG4uaW5uZXJEb25lPSEwLG4udmFsdWVEb25lPSEwLGwuY2hpbGROb2Rlc3x8KGwuY2hpbGROb2Rlcz1bXSksaT49bC5jaGlsZE5vZGVzLmxlbmd0aD9sLmNoaWxkTm9kZXMucHVzaChuKTpsLmNoaWxkTm9kZXMuc3BsaWNlKGksMCxuKSxsLnN1YnNldHMmJmwuc3Vic2V0cy5mb3JFYWNoKGZ1bmN0aW9uKGUpe2lmKGUub2xkVmFsdWU+PWkpZS5vbGRWYWx1ZSs9MTtlbHNlIGlmKGUub2xkVmFsdWU8aSYmZS5vbGRWYWx1ZStlLmxlbmd0aD5pKXt2YXIgdD1lLm9sZFZhbHVlK2UubGVuZ3RoLWk7dS5wdXNoKHtuZXdWYWx1ZTplLm5ld1ZhbHVlK2UubGVuZ3RoLXQsb2xkVmFsdWU6aSsxLGxlbmd0aDp0fSksZS5sZW5ndGgtPXR9fSk7YnJlYWs7Y2FzZSBvLl9jb25zdC5yZW1vdmVUZXh0RWxlbWVudDpyLmNoaWxkTm9kZXMuc3BsaWNlKGMsMSksXCJURVhUQVJFQVwiPT09ci5ub2RlTmFtZSYmZGVsZXRlIHIudmFsdWUsci5zdWJzZXRzJiZyLnN1YnNldHMuZm9yRWFjaChmdW5jdGlvbihlKXtlLm9sZFZhbHVlPmM/ZS5vbGRWYWx1ZS09MTplLm9sZFZhbHVlPT09Yz9lLmRlbGV0ZT0hMDplLm9sZFZhbHVlPGMmJmUub2xkVmFsdWUrZS5sZW5ndGg+YyYmKGUub2xkVmFsdWUrZS5sZW5ndGgtMT09PWM/ZS5sZW5ndGgtLToodS5wdXNoKHtuZXdWYWx1ZTplLm5ld1ZhbHVlK2MtZS5vbGRWYWx1ZSxvbGRWYWx1ZTpjLGxlbmd0aDplLmxlbmd0aC1jK2Uub2xkVmFsdWUtMX0pLGUubGVuZ3RoPWMtZS5vbGRWYWx1ZSkpfSksbD1yO2JyZWFrO2Nhc2Ugby5fY29uc3QuYWRkVGV4dEVsZW1lbnQ6cz10W28uX2NvbnN0LnJvdXRlXS5zbGljZSgpLGk9cy5zcGxpY2Uocy5sZW5ndGgtMSwxKVswXSwobj17fSkubm9kZU5hbWU9XCIjdGV4dFwiLG4uZGF0YT10W28uX2NvbnN0LnZhbHVlXSwobD1nZXRGcm9tVmlydHVhbFJvdXRlKGUscykubm9kZSkuY2hpbGROb2Rlc3x8KGwuY2hpbGROb2Rlcz1bXSksaT49bC5jaGlsZE5vZGVzLmxlbmd0aD9sLmNoaWxkTm9kZXMucHVzaChuKTpsLmNoaWxkTm9kZXMuc3BsaWNlKGksMCxuKSxcIlRFWFRBUkVBXCI9PT1sLm5vZGVOYW1lJiYobC52YWx1ZT10W28uX2NvbnN0Lm5ld1ZhbHVlXSksbC5zdWJzZXRzJiZsLnN1YnNldHMuZm9yRWFjaChmdW5jdGlvbihlKXtpZihlLm9sZFZhbHVlPj1pJiYoZS5vbGRWYWx1ZSs9MSksZS5vbGRWYWx1ZTxpJiZlLm9sZFZhbHVlK2UubGVuZ3RoPmkpe3ZhciB0PWUub2xkVmFsdWUrZS5sZW5ndGgtaTt1LnB1c2goe25ld1ZhbHVlOmUubmV3VmFsdWUrZS5sZW5ndGgtdCxvbGRWYWx1ZTppKzEsbGVuZ3RoOnR9KSxlLmxlbmd0aC09dH19KTticmVhaztkZWZhdWx0OmNvbnNvbGUubG9nKFwidW5rbm93biBhY3Rpb25cIil9bC5zdWJzZXRzJiYobC5zdWJzZXRzPWwuc3Vic2V0cy5maWx0ZXIoZnVuY3Rpb24oZSl7cmV0dXJuIWUuZGVsZXRlJiZlLm9sZFZhbHVlIT09ZS5uZXdWYWx1ZX0pLHUubGVuZ3RoJiYobC5zdWJzZXRzPWwuc3Vic2V0cy5jb25jYXQodSkpKSxkLm5ld05vZGU9bixvLnBvc3REaWZmQXBwbHkoZCl9ZnVuY3Rpb24gYXBwbHlWaXJ0dWFsKGUsdCxvKXtyZXR1cm4gdC5mb3JFYWNoKGZ1bmN0aW9uKHQpe2FwcGx5VmlydHVhbERpZmYoZSx0LG8pfSksITB9ZnVuY3Rpb24gbm9kZVRvT2JqKGUsdCl7dm9pZCAwPT09dCYmKHQ9e30pO3ZhciBvPXt9O2lmKG8ubm9kZU5hbWU9ZS5ub2RlTmFtZSxcIiN0ZXh0XCI9PT1vLm5vZGVOYW1lfHxcIiNjb21tZW50XCI9PT1vLm5vZGVOYW1lKW8uZGF0YT1lLmRhdGE7ZWxzZXtpZihlLmF0dHJpYnV0ZXMmJmUuYXR0cmlidXRlcy5sZW5ndGg+MClvLmF0dHJpYnV0ZXM9e30sQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoZS5hdHRyaWJ1dGVzKS5mb3JFYWNoKGZ1bmN0aW9uKGUpe3JldHVybiBvLmF0dHJpYnV0ZXNbZS5uYW1lXT1lLnZhbHVlfSk7aWYoXCJURVhUQVJFQVwiPT09by5ub2RlTmFtZSlvLnZhbHVlPWUudmFsdWU7ZWxzZSBpZihlLmNoaWxkTm9kZXMmJmUuY2hpbGROb2Rlcy5sZW5ndGg+MCl7by5jaGlsZE5vZGVzPVtdLEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGUuY2hpbGROb2RlcykuZm9yRWFjaChmdW5jdGlvbihlKXtyZXR1cm4gby5jaGlsZE5vZGVzLnB1c2gobm9kZVRvT2JqKGUsdCkpfSl9dC52YWx1ZURpZmZpbmcmJih2b2lkIDAhPT1lLmNoZWNrZWQmJmUudHlwZSYmW1wicmFkaW9cIixcImNoZWNrYm94XCJdLmluY2x1ZGVzKGUudHlwZS50b0xvd2VyQ2FzZSgpKT9vLmNoZWNrZWQ9ZS5jaGVja2VkOnZvaWQgMCE9PWUudmFsdWUmJihvLnZhbHVlPWUudmFsdWUpLHZvaWQgMCE9PWUuc2VsZWN0ZWQmJihvLnNlbGVjdGVkPWUuc2VsZWN0ZWQpKX1yZXR1cm4gb31EaWZmVHJhY2tlci5wcm90b3R5cGUuYWRkPWZ1bmN0aW9uKGUpe3ZhciB0Oyh0PXRoaXMubGlzdCkucHVzaC5hcHBseSh0LGUpfSxEaWZmVHJhY2tlci5wcm90b3R5cGUuZm9yRWFjaD1mdW5jdGlvbihlKXt0aGlzLmxpc3QuZm9yRWFjaChmdW5jdGlvbih0KXtyZXR1cm4gZSh0KX0pfTt2YXIgdGFnUkU9LzwoPzpcIlteXCJdKlwiWydcIl0qfCdbXiddKidbJ1wiXSp8W14nXCI+XSkrPi9nLGVtcHR5PU9iamVjdC5jcmVhdGU/T2JqZWN0LmNyZWF0ZShudWxsKTp7fSxhdHRyUkU9L1xccyhbXidcIlxcL1xccz48XSs/KVtcXHNcXC8+XXwoW15cXHM9XSspPVxccz8oXCIuKj9cInwnLio/JykvZztmdW5jdGlvbiB1bmVzY2FwZShlKXtyZXR1cm4gZS5yZXBsYWNlKC8mbHQ7L2csXCI8XCIpLnJlcGxhY2UoLyZndDsvZyxcIj5cIikucmVwbGFjZSgvJmFtcDsvZyxcIiZcIil9dmFyIGxvb2t1cD17YXJlYTohMCxiYXNlOiEwLGJyOiEwLGNvbDohMCxlbWJlZDohMCxocjohMCxpbWc6ITAsaW5wdXQ6ITAsa2V5Z2VuOiEwLGxpbms6ITAsbWVudUl0ZW06ITAsbWV0YTohMCxwYXJhbTohMCxzb3VyY2U6ITAsdHJhY2s6ITAsd2JyOiEwfTtmdW5jdGlvbiBwYXJzZVRhZyhlKXt2YXIgdD17bm9kZU5hbWU6XCJcIixhdHRyaWJ1dGVzOnt9fSxvPWUubWF0Y2goLzxcXC8/KFteXFxzXSs/KVtcXC9cXHM+XS8pO28mJih0Lm5vZGVOYW1lPW9bMV0udG9VcHBlckNhc2UoKSwobG9va3VwW29bMV0udG9Mb3dlckNhc2UoKV18fFwiL1wiPT09ZS5jaGFyQXQoZS5sZW5ndGgtMikpJiYodC52b2lkRWxlbWVudD0hMCkpO2Zvcih2YXIgbj1uZXcgUmVnRXhwKGF0dHJSRSkscz1udWxsLGk9ITE7IWk7KWlmKG51bGw9PT0ocz1uLmV4ZWMoZSkpKWk9ITA7ZWxzZSBpZihzWzBdLnRyaW0oKSlpZihzWzFdKXt2YXIgYT1zWzFdLnRyaW0oKSxsPVthLFwiXCJdO2EuaW5kZXhPZihcIj1cIik+LTEmJihsPWEuc3BsaXQoXCI9XCIpKSx0LmF0dHJpYnV0ZXNbbFswXV09bFsxXSxuLmxhc3RJbmRleC0tfWVsc2Ugc1syXSYmKHQuYXR0cmlidXRlc1tzWzJdXT1zWzNdLnRyaW0oKS5zdWJzdHJpbmcoMSxzWzNdLmxlbmd0aC0xKSk7cmV0dXJuIHR9ZnVuY3Rpb24gcGFyc2UoZSx0KXt2b2lkIDA9PT10JiYodD17Y29tcG9uZW50czplbXB0eX0pO3ZhciBvLG49W10scz0tMSxpPVtdLGE9e30sbD0hMTtyZXR1cm4gZS5yZXBsYWNlKHRhZ1JFLGZ1bmN0aW9uKHIsYyl7aWYobCl7aWYociE9PVwiPC9cIitvLm5vZGVOYW1lK1wiPlwiKXJldHVybjtsPSExfXZhciB1LGQ9XCIvXCIhPT1yLmNoYXJBdCgxKSxmPWMrci5sZW5ndGgsaD1lLmNoYXJBdChmKTtpZihkJiYocysrLFwidGFnXCI9PT0obz1wYXJzZVRhZyhyKSkudHlwZSYmdC5jb21wb25lbnRzW28ubm9kZU5hbWVdJiYoby50eXBlPVwiY29tcG9uZW50XCIsbD0hMCksby52b2lkRWxlbWVudHx8bHx8IWh8fFwiPFwiPT09aHx8KG8uY2hpbGROb2Rlc3x8KG8uY2hpbGROb2Rlcz1bXSksby5jaGlsZE5vZGVzLnB1c2goe25vZGVOYW1lOlwiI3RleHRcIixkYXRhOnVuZXNjYXBlKGUuc2xpY2UoZixlLmluZGV4T2YoXCI8XCIsZikpKX0pKSxhW28udGFnTmFtZV09bywwPT09cyYmbi5wdXNoKG8pLCh1PWlbcy0xXSkmJih1LmNoaWxkTm9kZXN8fCh1LmNoaWxkTm9kZXM9W10pLHUuY2hpbGROb2Rlcy5wdXNoKG8pKSxpW3NdPW8pLCghZHx8by52b2lkRWxlbWVudCkmJihzLS0sIWwmJlwiPFwiIT09aCYmaCkpe3U9LTE9PT1zP246aVtzXS5jaGlsZE5vZGVzfHxbXTt2YXIgcD1lLmluZGV4T2YoXCI8XCIsZiksbT11bmVzY2FwZShlLnNsaWNlKGYsLTE9PT1wP3ZvaWQgMDpwKSk7dS5wdXNoKHtub2RlTmFtZTpcIiN0ZXh0XCIsZGF0YTptfSl9fSksblswXX1mdW5jdGlvbiBjbGVhbk9iaihlKXtyZXR1cm4gZGVsZXRlIGUudm9pZEVsZW1lbnQsZS5jaGlsZE5vZGVzJiZlLmNoaWxkTm9kZXMuZm9yRWFjaChmdW5jdGlvbihlKXtyZXR1cm4gY2xlYW5PYmooZSl9KSxlfWZ1bmN0aW9uIHN0cmluZ1RvT2JqKGUpe3JldHVybiBjbGVhbk9iaihwYXJzZShlKSl9dmFyIERpZmZGaW5kZXI9ZnVuY3Rpb24oZSx0LG8pe3RoaXMub3B0aW9ucz1vLHRoaXMudDE9ZSBpbnN0YW5jZW9mIEhUTUxFbGVtZW50P25vZGVUb09iaihlLHRoaXMub3B0aW9ucyk6XCJzdHJpbmdcIj09dHlwZW9mIGU/c3RyaW5nVG9PYmooZSx0aGlzLm9wdGlvbnMpOkpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoZSkpLHRoaXMudDI9dCBpbnN0YW5jZW9mIEhUTUxFbGVtZW50P25vZGVUb09iaih0LHRoaXMub3B0aW9ucyk6XCJzdHJpbmdcIj09dHlwZW9mIHQ/c3RyaW5nVG9PYmoodCx0aGlzLm9wdGlvbnMpOkpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodCkpLHRoaXMuZGlmZmNvdW50PTAsdGhpcy5mb3VuZEFsbD0hMSx0aGlzLmRlYnVnJiYodGhpcy50MU9yaWc9bm9kZVRvT2JqKGUsdGhpcy5vcHRpb25zKSx0aGlzLnQyT3JpZz1ub2RlVG9PYmoodCx0aGlzLm9wdGlvbnMpKSx0aGlzLnRyYWNrZXI9bmV3IERpZmZUcmFja2VyfTtEaWZmRmluZGVyLnByb3RvdHlwZS5pbml0PWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZmluZERpZmZzKHRoaXMudDEsdGhpcy50Mil9LERpZmZGaW5kZXIucHJvdG90eXBlLmZpbmREaWZmcz1mdW5jdGlvbihlLHQpe3ZhciBvO2Rve2lmKHRoaXMub3B0aW9ucy5kZWJ1ZyYmKHRoaXMuZGlmZmNvdW50Kz0xLHRoaXMuZGlmZmNvdW50PnRoaXMub3B0aW9ucy5kaWZmY2FwKSl0aHJvdyB3aW5kb3cuZGlmZkVycm9yPVt0aGlzLnQxT3JpZyx0aGlzLnQyT3JpZ10sbmV3IEVycm9yKFwic3VycGFzc2VkIGRpZmZjYXA6XCIrSlNPTi5zdHJpbmdpZnkodGhpcy50MU9yaWcpK1wiIC0+IFwiK0pTT04uc3RyaW5naWZ5KHRoaXMudDJPcmlnKSk7MD09PShvPXRoaXMuZmluZE5leHREaWZmKGUsdCxbXSkpLmxlbmd0aCYmKGlzRXF1YWwoZSx0KXx8KHRoaXMuZm91bmRBbGw/Y29uc29sZS5lcnJvcihcIkNvdWxkIG5vdCBmaW5kIHJlbWFpbmluZyBkaWZmcyFcIik6KHRoaXMuZm91bmRBbGw9ITAscmVtb3ZlRG9uZShlKSxvPXRoaXMuZmluZE5leHREaWZmKGUsdCxbXSkpKSksby5sZW5ndGg+MCYmKHRoaXMuZm91bmRBbGw9ITEsdGhpcy50cmFja2VyLmFkZChvKSxhcHBseVZpcnR1YWwoZSxvLHRoaXMub3B0aW9ucykpfXdoaWxlKG8ubGVuZ3RoPjApO3JldHVybiB0aGlzLnRyYWNrZXIubGlzdH0sRGlmZkZpbmRlci5wcm90b3R5cGUuZmluZE5leHREaWZmPWZ1bmN0aW9uKGUsdCxvKXt2YXIgbixzO2lmKHRoaXMub3B0aW9ucy5tYXhEZXB0aCYmby5sZW5ndGg+dGhpcy5vcHRpb25zLm1heERlcHRoKXJldHVybltdO2lmKCFlLm91dGVyRG9uZSl7aWYobj10aGlzLmZpbmRPdXRlckRpZmYoZSx0LG8pLHRoaXMub3B0aW9ucy5maWx0ZXJPdXRlckRpZmYmJihzPXRoaXMub3B0aW9ucy5maWx0ZXJPdXRlckRpZmYoZSx0LG4pKSYmKG49cyksbi5sZW5ndGg+MClyZXR1cm4gZS5vdXRlckRvbmU9ITAsbjtlLm91dGVyRG9uZT0hMH1pZighZS5pbm5lckRvbmUpe2lmKChuPXRoaXMuZmluZElubmVyRGlmZihlLHQsbykpLmxlbmd0aD4wKXJldHVybiBuO2UuaW5uZXJEb25lPSEwfWlmKHRoaXMub3B0aW9ucy52YWx1ZURpZmZpbmcmJiFlLnZhbHVlRG9uZSl7aWYoKG49dGhpcy5maW5kVmFsdWVEaWZmKGUsdCxvKSkubGVuZ3RoPjApcmV0dXJuIGUudmFsdWVEb25lPSEwLG47ZS52YWx1ZURvbmU9ITB9cmV0dXJuW119LERpZmZGaW5kZXIucHJvdG90eXBlLmZpbmRPdXRlckRpZmY9ZnVuY3Rpb24oZSx0LG8pe3ZhciBuLHMsaSxhLGwscixjPVtdO2lmKGUubm9kZU5hbWUhPT10Lm5vZGVOYW1lKXtpZighby5sZW5ndGgpdGhyb3cgbmV3IEVycm9yKFwiVG9wIGxldmVsIG5vZGVzIGhhdmUgdG8gYmUgb2YgdGhlIHNhbWUga2luZC5cIik7cmV0dXJuWyhuZXcgRGlmZikuc2V0VmFsdWUodGhpcy5vcHRpb25zLl9jb25zdC5hY3Rpb24sdGhpcy5vcHRpb25zLl9jb25zdC5yZXBsYWNlRWxlbWVudCkuc2V0VmFsdWUodGhpcy5vcHRpb25zLl9jb25zdC5vbGRWYWx1ZSxjbG9uZU9iaihlKSkuc2V0VmFsdWUodGhpcy5vcHRpb25zLl9jb25zdC5uZXdWYWx1ZSxjbG9uZU9iaih0KSkuc2V0VmFsdWUodGhpcy5vcHRpb25zLl9jb25zdC5yb3V0ZSxvKV19aWYoby5sZW5ndGgmJnRoaXMub3B0aW9ucy5tYXhOb2RlRGlmZkNvdW50PE1hdGguYWJzKChlLmNoaWxkTm9kZXN8fFtdKS5sZW5ndGgtKHQuY2hpbGROb2Rlc3x8W10pLmxlbmd0aCkpcmV0dXJuWyhuZXcgRGlmZikuc2V0VmFsdWUodGhpcy5vcHRpb25zLl9jb25zdC5hY3Rpb24sdGhpcy5vcHRpb25zLl9jb25zdC5yZXBsYWNlRWxlbWVudCkuc2V0VmFsdWUodGhpcy5vcHRpb25zLl9jb25zdC5vbGRWYWx1ZSxjbG9uZU9iaihlKSkuc2V0VmFsdWUodGhpcy5vcHRpb25zLl9jb25zdC5uZXdWYWx1ZSxjbG9uZU9iaih0KSkuc2V0VmFsdWUodGhpcy5vcHRpb25zLl9jb25zdC5yb3V0ZSxvKV07aWYoZS5kYXRhIT09dC5kYXRhKXJldHVyblwiI3RleHRcIj09PWUubm9kZU5hbWU/WyhuZXcgRGlmZikuc2V0VmFsdWUodGhpcy5vcHRpb25zLl9jb25zdC5hY3Rpb24sdGhpcy5vcHRpb25zLl9jb25zdC5tb2RpZnlUZXh0RWxlbWVudCkuc2V0VmFsdWUodGhpcy5vcHRpb25zLl9jb25zdC5yb3V0ZSxvKS5zZXRWYWx1ZSh0aGlzLm9wdGlvbnMuX2NvbnN0Lm9sZFZhbHVlLGUuZGF0YSkuc2V0VmFsdWUodGhpcy5vcHRpb25zLl9jb25zdC5uZXdWYWx1ZSx0LmRhdGEpXTpbKG5ldyBEaWZmKS5zZXRWYWx1ZSh0aGlzLm9wdGlvbnMuX2NvbnN0LmFjdGlvbix0aGlzLm9wdGlvbnMuX2NvbnN0Lm1vZGlmeUNvbW1lbnQpLnNldFZhbHVlKHRoaXMub3B0aW9ucy5fY29uc3Qucm91dGUsbykuc2V0VmFsdWUodGhpcy5vcHRpb25zLl9jb25zdC5vbGRWYWx1ZSxlLmRhdGEpLnNldFZhbHVlKHRoaXMub3B0aW9ucy5fY29uc3QubmV3VmFsdWUsdC5kYXRhKV07Zm9yKHM9ZS5hdHRyaWJ1dGVzP09iamVjdC5rZXlzKGUuYXR0cmlidXRlcykuc29ydCgpOltdLGk9dC5hdHRyaWJ1dGVzP09iamVjdC5rZXlzKHQuYXR0cmlidXRlcykuc29ydCgpOltdLGE9cy5sZW5ndGgscj0wO3I8YTtyKyspbj1zW3JdLC0xPT09KGw9aS5pbmRleE9mKG4pKT9jLnB1c2goKG5ldyBEaWZmKS5zZXRWYWx1ZSh0aGlzLm9wdGlvbnMuX2NvbnN0LmFjdGlvbix0aGlzLm9wdGlvbnMuX2NvbnN0LnJlbW92ZUF0dHJpYnV0ZSkuc2V0VmFsdWUodGhpcy5vcHRpb25zLl9jb25zdC5yb3V0ZSxvKS5zZXRWYWx1ZSh0aGlzLm9wdGlvbnMuX2NvbnN0Lm5hbWUsbikuc2V0VmFsdWUodGhpcy5vcHRpb25zLl9jb25zdC52YWx1ZSxlLmF0dHJpYnV0ZXNbbl0pKTooaS5zcGxpY2UobCwxKSxlLmF0dHJpYnV0ZXNbbl0hPT10LmF0dHJpYnV0ZXNbbl0mJmMucHVzaCgobmV3IERpZmYpLnNldFZhbHVlKHRoaXMub3B0aW9ucy5fY29uc3QuYWN0aW9uLHRoaXMub3B0aW9ucy5fY29uc3QubW9kaWZ5QXR0cmlidXRlKS5zZXRWYWx1ZSh0aGlzLm9wdGlvbnMuX2NvbnN0LnJvdXRlLG8pLnNldFZhbHVlKHRoaXMub3B0aW9ucy5fY29uc3QubmFtZSxuKS5zZXRWYWx1ZSh0aGlzLm9wdGlvbnMuX2NvbnN0Lm9sZFZhbHVlLGUuYXR0cmlidXRlc1tuXSkuc2V0VmFsdWUodGhpcy5vcHRpb25zLl9jb25zdC5uZXdWYWx1ZSx0LmF0dHJpYnV0ZXNbbl0pKSk7Zm9yKGE9aS5sZW5ndGgscj0wO3I8YTtyKyspbj1pW3JdLGMucHVzaCgobmV3IERpZmYpLnNldFZhbHVlKHRoaXMub3B0aW9ucy5fY29uc3QuYWN0aW9uLHRoaXMub3B0aW9ucy5fY29uc3QuYWRkQXR0cmlidXRlKS5zZXRWYWx1ZSh0aGlzLm9wdGlvbnMuX2NvbnN0LnJvdXRlLG8pLnNldFZhbHVlKHRoaXMub3B0aW9ucy5fY29uc3QubmFtZSxuKS5zZXRWYWx1ZSh0aGlzLm9wdGlvbnMuX2NvbnN0LnZhbHVlLHQuYXR0cmlidXRlc1tuXSkpO3JldHVybiBjfSxEaWZmRmluZGVyLnByb3RvdHlwZS5maW5kSW5uZXJEaWZmPWZ1bmN0aW9uKGUsdCxvKXt2YXIgbj1lLmNoaWxkTm9kZXM/ZS5jaGlsZE5vZGVzLnNsaWNlKCk6W10scz10LmNoaWxkTm9kZXM/dC5jaGlsZE5vZGVzLnNsaWNlKCk6W10saT1NYXRoLm1heChuLmxlbmd0aCxzLmxlbmd0aCksYT1NYXRoLmFicyhuLmxlbmd0aC1zLmxlbmd0aCksbD1bXSxyPTA7aWYoIXRoaXMub3B0aW9ucy5tYXhDaGlsZENvdW50fHxpPHRoaXMub3B0aW9ucy5tYXhDaGlsZENvdW50KXt2YXIgYz1lLnN1YnNldHMmJmUuc3Vic2V0c0FnZS0tP2Uuc3Vic2V0czplLmNoaWxkTm9kZXMmJnQuY2hpbGROb2Rlcz9tYXJrU3ViVHJlZXMoZSx0KTpbXTtpZihjLmxlbmd0aD4wJiYobD10aGlzLmF0dGVtcHRHcm91cFJlbG9jYXRpb24oZSx0LGMsbykpLmxlbmd0aD4wKXJldHVybiBsfWZvcih2YXIgdT0wO3U8aTt1Kz0xKXt2YXIgZD1uW3VdLGY9c1t1XTthJiYoZCYmIWY/XCIjdGV4dFwiPT09ZC5ub2RlTmFtZT8obC5wdXNoKChuZXcgRGlmZikuc2V0VmFsdWUodGhpcy5vcHRpb25zLl9jb25zdC5hY3Rpb24sdGhpcy5vcHRpb25zLl9jb25zdC5yZW1vdmVUZXh0RWxlbWVudCkuc2V0VmFsdWUodGhpcy5vcHRpb25zLl9jb25zdC5yb3V0ZSxvLmNvbmNhdChyKSkuc2V0VmFsdWUodGhpcy5vcHRpb25zLl9jb25zdC52YWx1ZSxkLmRhdGEpKSxyLT0xKToobC5wdXNoKChuZXcgRGlmZikuc2V0VmFsdWUodGhpcy5vcHRpb25zLl9jb25zdC5hY3Rpb24sdGhpcy5vcHRpb25zLl9jb25zdC5yZW1vdmVFbGVtZW50KS5zZXRWYWx1ZSh0aGlzLm9wdGlvbnMuX2NvbnN0LnJvdXRlLG8uY29uY2F0KHIpKS5zZXRWYWx1ZSh0aGlzLm9wdGlvbnMuX2NvbnN0LmVsZW1lbnQsY2xvbmVPYmooZCkpKSxyLT0xKTpmJiYhZCYmKFwiI3RleHRcIj09PWYubm9kZU5hbWU/bC5wdXNoKChuZXcgRGlmZikuc2V0VmFsdWUodGhpcy5vcHRpb25zLl9jb25zdC5hY3Rpb24sdGhpcy5vcHRpb25zLl9jb25zdC5hZGRUZXh0RWxlbWVudCkuc2V0VmFsdWUodGhpcy5vcHRpb25zLl9jb25zdC5yb3V0ZSxvLmNvbmNhdChyKSkuc2V0VmFsdWUodGhpcy5vcHRpb25zLl9jb25zdC52YWx1ZSxmLmRhdGEpKTpsLnB1c2goKG5ldyBEaWZmKS5zZXRWYWx1ZSh0aGlzLm9wdGlvbnMuX2NvbnN0LmFjdGlvbix0aGlzLm9wdGlvbnMuX2NvbnN0LmFkZEVsZW1lbnQpLnNldFZhbHVlKHRoaXMub3B0aW9ucy5fY29uc3Qucm91dGUsby5jb25jYXQocikpLnNldFZhbHVlKHRoaXMub3B0aW9ucy5fY29uc3QuZWxlbWVudCxjbG9uZU9iaihmKSkpKSksZCYmZiYmKCF0aGlzLm9wdGlvbnMubWF4Q2hpbGRDb3VudHx8aTx0aGlzLm9wdGlvbnMubWF4Q2hpbGRDb3VudD9sPWwuY29uY2F0KHRoaXMuZmluZE5leHREaWZmKGQsZixvLmNvbmNhdChyKSkpOmlzRXF1YWwoZCxmKXx8KG4ubGVuZ3RoPnMubGVuZ3RoPyhsPWwuY29uY2F0KFsobmV3IERpZmYpLnNldFZhbHVlKHRoaXMub3B0aW9ucy5fY29uc3QuYWN0aW9uLHRoaXMub3B0aW9ucy5fY29uc3QucmVtb3ZlRWxlbWVudCkuc2V0VmFsdWUodGhpcy5vcHRpb25zLl9jb25zdC5lbGVtZW50LGNsb25lT2JqKGQpKS5zZXRWYWx1ZSh0aGlzLm9wdGlvbnMuX2NvbnN0LnJvdXRlLG8uY29uY2F0KHIpKV0pLG4uc3BsaWNlKHUsMSksci09MSxhLT0xKTpuLmxlbmd0aDxzLmxlbmd0aD8obD1sLmNvbmNhdChbKG5ldyBEaWZmKS5zZXRWYWx1ZSh0aGlzLm9wdGlvbnMuX2NvbnN0LmFjdGlvbix0aGlzLm9wdGlvbnMuX2NvbnN0LmFkZEVsZW1lbnQpLnNldFZhbHVlKHRoaXMub3B0aW9ucy5fY29uc3QuZWxlbWVudCxjbG9uZU9iaihmKSkuc2V0VmFsdWUodGhpcy5vcHRpb25zLl9jb25zdC5yb3V0ZSxvLmNvbmNhdChyKSldKSxuLnNwbGljZSh1LDAse30pLGEtPTEpOmw9bC5jb25jYXQoWyhuZXcgRGlmZikuc2V0VmFsdWUodGhpcy5vcHRpb25zLl9jb25zdC5hY3Rpb24sdGhpcy5vcHRpb25zLl9jb25zdC5yZXBsYWNlRWxlbWVudCkuc2V0VmFsdWUodGhpcy5vcHRpb25zLl9jb25zdC5vbGRWYWx1ZSxjbG9uZU9iaihkKSkuc2V0VmFsdWUodGhpcy5vcHRpb25zLl9jb25zdC5uZXdWYWx1ZSxjbG9uZU9iaihmKSkuc2V0VmFsdWUodGhpcy5vcHRpb25zLl9jb25zdC5yb3V0ZSxvLmNvbmNhdChyKSldKSkpLHIrPTF9cmV0dXJuIGUuaW5uZXJEb25lPSEwLGx9LERpZmZGaW5kZXIucHJvdG90eXBlLmF0dGVtcHRHcm91cFJlbG9jYXRpb249ZnVuY3Rpb24oZSx0LG8sbil7Zm9yKHZhciBzLGksYSxsLHIsYyx1PWdldEdhcEluZm9ybWF0aW9uKGUsdCxvKSxkPXUuZ2FwczEsZj11LmdhcHMyLGg9TWF0aC5taW4oZC5sZW5ndGgsZi5sZW5ndGgpLHA9W10sbT0wLGc9MDttPGg7Zys9MSxtKz0xKWlmKCEwPT09ZFttXSlpZihcIiN0ZXh0XCI9PT0obD1lLmNoaWxkTm9kZXNbZ10pLm5vZGVOYW1lKXtpZihcIiN0ZXh0XCI9PT10LmNoaWxkTm9kZXNbbV0ubm9kZU5hbWUmJmwuZGF0YSE9PXQuY2hpbGROb2Rlc1ttXS5kYXRhKXtmb3IoYz1nO2UuY2hpbGROb2Rlcy5sZW5ndGg+YysxJiZcIiN0ZXh0XCI9PT1lLmNoaWxkTm9kZXNbYysxXS5ub2RlTmFtZTspaWYoYys9MSx0LmNoaWxkTm9kZXNbbV0uZGF0YT09PWUuY2hpbGROb2Rlc1tjXS5kYXRhKXtyPSEwO2JyZWFrfWlmKCFyKXJldHVybiBwLnB1c2goKG5ldyBEaWZmKS5zZXRWYWx1ZSh0aGlzLm9wdGlvbnMuX2NvbnN0LmFjdGlvbix0aGlzLm9wdGlvbnMuX2NvbnN0Lm1vZGlmeVRleHRFbGVtZW50KS5zZXRWYWx1ZSh0aGlzLm9wdGlvbnMuX2NvbnN0LnJvdXRlLG4uY29uY2F0KG0pKS5zZXRWYWx1ZSh0aGlzLm9wdGlvbnMuX2NvbnN0Lm9sZFZhbHVlLGwuZGF0YSkuc2V0VmFsdWUodGhpcy5vcHRpb25zLl9jb25zdC5uZXdWYWx1ZSx0LmNoaWxkTm9kZXNbbV0uZGF0YSkpLHB9cC5wdXNoKChuZXcgRGlmZikuc2V0VmFsdWUodGhpcy5vcHRpb25zLl9jb25zdC5hY3Rpb24sdGhpcy5vcHRpb25zLl9jb25zdC5yZW1vdmVUZXh0RWxlbWVudCkuc2V0VmFsdWUodGhpcy5vcHRpb25zLl9jb25zdC5yb3V0ZSxuLmNvbmNhdChtKSkuc2V0VmFsdWUodGhpcy5vcHRpb25zLl9jb25zdC52YWx1ZSxsLmRhdGEpKSxkLnNwbGljZShtLDEpLGg9TWF0aC5taW4oZC5sZW5ndGgsZi5sZW5ndGgpLG0tPTF9ZWxzZSBwLnB1c2goKG5ldyBEaWZmKS5zZXRWYWx1ZSh0aGlzLm9wdGlvbnMuX2NvbnN0LmFjdGlvbix0aGlzLm9wdGlvbnMuX2NvbnN0LnJlbW92ZUVsZW1lbnQpLnNldFZhbHVlKHRoaXMub3B0aW9ucy5fY29uc3Qucm91dGUsbi5jb25jYXQobSkpLnNldFZhbHVlKHRoaXMub3B0aW9ucy5fY29uc3QuZWxlbWVudCxjbG9uZU9iaihsKSkpLGQuc3BsaWNlKG0sMSksaD1NYXRoLm1pbihkLmxlbmd0aCxmLmxlbmd0aCksbS09MTtlbHNlIGlmKCEwPT09ZlttXSlcIiN0ZXh0XCI9PT0obD10LmNoaWxkTm9kZXNbbV0pLm5vZGVOYW1lPyhwLnB1c2goKG5ldyBEaWZmKS5zZXRWYWx1ZSh0aGlzLm9wdGlvbnMuX2NvbnN0LmFjdGlvbix0aGlzLm9wdGlvbnMuX2NvbnN0LmFkZFRleHRFbGVtZW50KS5zZXRWYWx1ZSh0aGlzLm9wdGlvbnMuX2NvbnN0LnJvdXRlLG4uY29uY2F0KG0pKS5zZXRWYWx1ZSh0aGlzLm9wdGlvbnMuX2NvbnN0LnZhbHVlLGwuZGF0YSkpLGQuc3BsaWNlKG0sMCwhMCksaD1NYXRoLm1pbihkLmxlbmd0aCxmLmxlbmd0aCksZy09MSk6KHAucHVzaCgobmV3IERpZmYpLnNldFZhbHVlKHRoaXMub3B0aW9ucy5fY29uc3QuYWN0aW9uLHRoaXMub3B0aW9ucy5fY29uc3QuYWRkRWxlbWVudCkuc2V0VmFsdWUodGhpcy5vcHRpb25zLl9jb25zdC5yb3V0ZSxuLmNvbmNhdChtKSkuc2V0VmFsdWUodGhpcy5vcHRpb25zLl9jb25zdC5lbGVtZW50LGNsb25lT2JqKGwpKSksZC5zcGxpY2UobSwwLCEwKSxoPU1hdGgubWluKGQubGVuZ3RoLGYubGVuZ3RoKSxnLT0xKTtlbHNlIGlmKGRbbV0hPT1mW21dKXtpZihwLmxlbmd0aD4wKXJldHVybiBwO2lmKGE9b1tkW21dXSwoaT1NYXRoLm1pbihhLm5ld1ZhbHVlLGUuY2hpbGROb2Rlcy5sZW5ndGgtYS5sZW5ndGgpKSE9PWEub2xkVmFsdWUpe3M9ITE7Zm9yKHZhciBfPTA7XzxhLmxlbmd0aDtfKz0xKXJvdWdobHlFcXVhbChlLmNoaWxkTm9kZXNbaStfXSxlLmNoaWxkTm9kZXNbYS5vbGRWYWx1ZStfXSxbXSwhMSwhMCl8fChzPSEwKTtpZihzKXJldHVyblsobmV3IERpZmYpLnNldFZhbHVlKHRoaXMub3B0aW9ucy5fY29uc3QuYWN0aW9uLHRoaXMub3B0aW9ucy5fY29uc3QucmVsb2NhdGVHcm91cCkuc2V0VmFsdWUoXCJncm91cExlbmd0aFwiLGEubGVuZ3RoKS5zZXRWYWx1ZSh0aGlzLm9wdGlvbnMuX2NvbnN0LmZyb20sYS5vbGRWYWx1ZSkuc2V0VmFsdWUodGhpcy5vcHRpb25zLl9jb25zdC50byxpKS5zZXRWYWx1ZSh0aGlzLm9wdGlvbnMuX2NvbnN0LnJvdXRlLG4pXX19cmV0dXJuIHB9LERpZmZGaW5kZXIucHJvdG90eXBlLmZpbmRWYWx1ZURpZmY9ZnVuY3Rpb24oZSx0LG8pe3ZhciBuPVtdO3JldHVybiBlLnNlbGVjdGVkIT09dC5zZWxlY3RlZCYmbi5wdXNoKChuZXcgRGlmZikuc2V0VmFsdWUodGhpcy5vcHRpb25zLl9jb25zdC5hY3Rpb24sdGhpcy5vcHRpb25zLl9jb25zdC5tb2RpZnlTZWxlY3RlZCkuc2V0VmFsdWUodGhpcy5vcHRpb25zLl9jb25zdC5vbGRWYWx1ZSxlLnNlbGVjdGVkKS5zZXRWYWx1ZSh0aGlzLm9wdGlvbnMuX2NvbnN0Lm5ld1ZhbHVlLHQuc2VsZWN0ZWQpLnNldFZhbHVlKHRoaXMub3B0aW9ucy5fY29uc3Qucm91dGUsbykpLChlLnZhbHVlfHx0LnZhbHVlKSYmZS52YWx1ZSE9PXQudmFsdWUmJlwiT1BUSU9OXCIhPT1lLm5vZGVOYW1lJiZuLnB1c2goKG5ldyBEaWZmKS5zZXRWYWx1ZSh0aGlzLm9wdGlvbnMuX2NvbnN0LmFjdGlvbix0aGlzLm9wdGlvbnMuX2NvbnN0Lm1vZGlmeVZhbHVlKS5zZXRWYWx1ZSh0aGlzLm9wdGlvbnMuX2NvbnN0Lm9sZFZhbHVlLGUudmFsdWV8fFwiXCIpLnNldFZhbHVlKHRoaXMub3B0aW9ucy5fY29uc3QubmV3VmFsdWUsdC52YWx1ZXx8XCJcIikuc2V0VmFsdWUodGhpcy5vcHRpb25zLl9jb25zdC5yb3V0ZSxvKSksZS5jaGVja2VkIT09dC5jaGVja2VkJiZuLnB1c2goKG5ldyBEaWZmKS5zZXRWYWx1ZSh0aGlzLm9wdGlvbnMuX2NvbnN0LmFjdGlvbix0aGlzLm9wdGlvbnMuX2NvbnN0Lm1vZGlmeUNoZWNrZWQpLnNldFZhbHVlKHRoaXMub3B0aW9ucy5fY29uc3Qub2xkVmFsdWUsZS5jaGVja2VkKS5zZXRWYWx1ZSh0aGlzLm9wdGlvbnMuX2NvbnN0Lm5ld1ZhbHVlLHQuY2hlY2tlZCkuc2V0VmFsdWUodGhpcy5vcHRpb25zLl9jb25zdC5yb3V0ZSxvKSksbn07dmFyIERFRkFVTFRfT1BUSU9OUz17ZGVidWc6ITEsZGlmZmNhcDoxMCxtYXhEZXB0aDohMSxtYXhDaGlsZENvdW50OjUwLHZhbHVlRGlmZmluZzohMCx0ZXh0RGlmZjpmdW5jdGlvbihlLHQsbyxuKXtlLmRhdGE9bn0scHJlVmlydHVhbERpZmZBcHBseTpmdW5jdGlvbigpe30scG9zdFZpcnR1YWxEaWZmQXBwbHk6ZnVuY3Rpb24oKXt9LHByZURpZmZBcHBseTpmdW5jdGlvbigpe30scG9zdERpZmZBcHBseTpmdW5jdGlvbigpe30sZmlsdGVyT3V0ZXJEaWZmOm51bGwsY29tcHJlc3M6ITEsX2NvbnN0OiExLGRvY3VtZW50OiEoIXdpbmRvd3x8IXdpbmRvdy5kb2N1bWVudCkmJndpbmRvdy5kb2N1bWVudH0sRGlmZkRPTT1mdW5jdGlvbihlKXt2YXIgdD10aGlzO2lmKHZvaWQgMD09PWUmJihlPXt9KSx0aGlzLm9wdGlvbnM9ZSxPYmplY3QuZW50cmllcyhERUZBVUxUX09QVElPTlMpLmZvckVhY2goZnVuY3Rpb24oZSl7dmFyIG89ZVswXSxuPWVbMV07T2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHQub3B0aW9ucyxvKXx8KHQub3B0aW9uc1tvXT1uKX0pLCF0aGlzLm9wdGlvbnMuX2NvbnN0KXt2YXIgbz1bXCJhZGRBdHRyaWJ1dGVcIixcIm1vZGlmeUF0dHJpYnV0ZVwiLFwicmVtb3ZlQXR0cmlidXRlXCIsXCJtb2RpZnlUZXh0RWxlbWVudFwiLFwicmVsb2NhdGVHcm91cFwiLFwicmVtb3ZlRWxlbWVudFwiLFwiYWRkRWxlbWVudFwiLFwicmVtb3ZlVGV4dEVsZW1lbnRcIixcImFkZFRleHRFbGVtZW50XCIsXCJyZXBsYWNlRWxlbWVudFwiLFwibW9kaWZ5VmFsdWVcIixcIm1vZGlmeUNoZWNrZWRcIixcIm1vZGlmeVNlbGVjdGVkXCIsXCJtb2RpZnlDb21tZW50XCIsXCJhY3Rpb25cIixcInJvdXRlXCIsXCJvbGRWYWx1ZVwiLFwibmV3VmFsdWVcIixcImVsZW1lbnRcIixcImdyb3VwXCIsXCJmcm9tXCIsXCJ0b1wiLFwibmFtZVwiLFwidmFsdWVcIixcImRhdGFcIixcImF0dHJpYnV0ZXNcIixcIm5vZGVOYW1lXCIsXCJjaGlsZE5vZGVzXCIsXCJjaGVja2VkXCIsXCJzZWxlY3RlZFwiXTt0aGlzLm9wdGlvbnMuX2NvbnN0PXt9LHRoaXMub3B0aW9ucy5jb21wcmVzcz9vLmZvckVhY2goZnVuY3Rpb24oZSxvKXtyZXR1cm4gdC5vcHRpb25zLl9jb25zdFtlXT1vfSk6by5mb3JFYWNoKGZ1bmN0aW9uKGUpe3JldHVybiB0Lm9wdGlvbnMuX2NvbnN0W2VdPWV9KX10aGlzLkRpZmZGaW5kZXI9RGlmZkZpbmRlcn07RGlmZkRPTS5wcm90b3R5cGUuYXBwbHk9ZnVuY3Rpb24oZSx0KXtyZXR1cm4gYXBwbHlET00oZSx0LHRoaXMub3B0aW9ucyl9LERpZmZET00ucHJvdG90eXBlLnVuZG89ZnVuY3Rpb24oZSx0KXtyZXR1cm4gdW5kb0RPTShlLHQsdGhpcy5vcHRpb25zKX0sRGlmZkRPTS5wcm90b3R5cGUuZGlmZj1mdW5jdGlvbihlLHQpe3JldHVybiBuZXcgdGhpcy5EaWZmRmluZGVyKGUsdCx0aGlzLm9wdGlvbnMpLmluaXQoKX07dmFyIFRyYWNlTG9nZ2VyPWZ1bmN0aW9uKGUpe3ZhciB0PXRoaXM7dm9pZCAwPT09ZSYmKGU9e30pLHRoaXMucGFkPVwi4pSCICAgXCIsdGhpcy5wYWRkaW5nPVwiXCIsdGhpcy50aWNrPTEsdGhpcy5tZXNzYWdlcz1bXTt2YXIgbz1mdW5jdGlvbihlLG8pe3ZhciBuPWVbb107ZVtvXT1mdW5jdGlvbigpe2Zvcih2YXIgcz1bXSxpPWFyZ3VtZW50cy5sZW5ndGg7aS0tOylzW2ldPWFyZ3VtZW50c1tpXTt0LmZpbihvLEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKHMpKTt2YXIgYT1uLmFwcGx5KGUscyk7cmV0dXJuIHQuZm91dChvLGEpLGF9fTtmb3IodmFyIG4gaW4gZSlcImZ1bmN0aW9uXCI9PXR5cGVvZiBlW25dJiZvKGUsbik7dGhpcy5sb2coXCLilIwgVFJBQ0VMT0cgU1RBUlRcIil9O1RyYWNlTG9nZ2VyLnByb3RvdHlwZS5maW49ZnVuY3Rpb24oZSx0KXt0aGlzLnBhZGRpbmcrPXRoaXMucGFkLHRoaXMubG9nKFwi4pSc4pSAPiBlbnRlcmluZyBcIitlLHQpfSxUcmFjZUxvZ2dlci5wcm90b3R5cGUuZm91dD1mdW5jdGlvbihlLHQpe3RoaXMubG9nKFwi4pSCPOKUgOKUgOKUmCBnZW5lcmF0ZWQgcmV0dXJuIHZhbHVlXCIsdCksdGhpcy5wYWRkaW5nPXRoaXMucGFkZGluZy5zdWJzdHJpbmcoMCx0aGlzLnBhZGRpbmcubGVuZ3RoLXRoaXMucGFkLmxlbmd0aCl9LFRyYWNlTG9nZ2VyLnByb3RvdHlwZS5mb3JtYXQ9ZnVuY3Rpb24oZSx0KXtyZXR1cm4gZnVuY3Rpb24oZSl7Zm9yKGU9XCJcIitlO2UubGVuZ3RoPDQ7KWU9XCIwXCIrZTtyZXR1cm4gZX0odCkrXCI+IFwiK3RoaXMucGFkZGluZytlfSxUcmFjZUxvZ2dlci5wcm90b3R5cGUubG9nPWZ1bmN0aW9uKCl7dmFyIGU9QXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzKSx0PWZ1bmN0aW9uKGUpe3JldHVybiBlP1wic3RyaW5nXCI9PXR5cGVvZiBlP2U6ZSBpbnN0YW5jZW9mIEhUTUxFbGVtZW50P2Uub3V0ZXJIVE1MfHxcIjxlbXB0eT5cIjplIGluc3RhbmNlb2YgQXJyYXk/XCJbXCIrZS5tYXAodCkuam9pbihcIixcIikrXCJdXCI6ZS50b1N0cmluZygpfHxlLnZhbHVlT2YoKXx8XCI8dW5rbm93bj5cIjpcIjxmYWxzZXk+XCJ9O2U9ZS5tYXAodCkuam9pbihcIiwgXCIpLHRoaXMubWVzc2FnZXMucHVzaCh0aGlzLmZvcm1hdChlLHRoaXMudGljaysrKSl9LFRyYWNlTG9nZ2VyLnByb3RvdHlwZS50b1N0cmluZz1mdW5jdGlvbigpe2Zvcih2YXIgZT1cIuKUlOKUgOKUgOKUgFwiO2UubGVuZ3RoPD10aGlzLnBhZGRpbmcubGVuZ3RoK3RoaXMucGFkLmxlbmd0aDspZSs9XCLDlyAgIFwiO3ZhciB0PXRoaXMucGFkZGluZztyZXR1cm4gdGhpcy5wYWRkaW5nPVwiXCIsZT10aGlzLmZvcm1hdChlLHRoaXMudGljayksdGhpcy5wYWRkaW5nPXQsdGhpcy5tZXNzYWdlcy5qb2luKFwiXFxuXCIpK1wiXFxuXCIrZX0sZXhwb3J0cy5EaWZmRE9NPURpZmZET00sZXhwb3J0cy5UcmFjZUxvZ2dlcj1UcmFjZUxvZ2dlcixleHBvcnRzLm5vZGVUb09iaj1ub2RlVG9PYmosZXhwb3J0cy5zdHJpbmdUb09iaj1zdHJpbmdUb09iajtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWluZGV4LmpzLm1hcFxuIl19
